<!DOCTYPE html>
<html lang="en">
<head>
<!--
    Licensed to the Apache Software Foundation (ASF) under one or more
    contributor license agreements.  See the NOTICE file distributed with
    this work for additional information regarding copyright ownership.
    The ASF licenses this file to You under the Apache License, Version 2.0
    (the "License"); you may not use this file except in compliance with
    the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
-->
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/paper/bootstrap.min.css" rel="stylesheet" integrity="sha384-awusxf8AUojygHf2+joICySzB780jVvQaVCAt1clU3QsyAitLGul28Qxb2r1e5g+" crossorigin="anonymous">
<link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/bs/jq-2.2.3/dt-1.10.12/datatables.min.css">
<link href="/css/accumulo.css" rel="stylesheet" type="text/css">

<title>Accumulo Documentation - Proxy</title>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script type="text/javascript" src="https://cdn.datatables.net/v/bs/jq-2.2.3/dt-1.10.12/datatables.min.js"></script>
<script>
  // show location of canonical site if not currently on the canonical site
  $(function() {
    var host = window.location.host;
    if (typeof host !== 'undefined' && host !== 'accumulo.apache.org') {
      $('#non-canonical').show();
    }
  });

  $(function() {
    // decorate section headers with anchors
    return $("h2, h3, h4, h5, h6").each(function(i, el) {
      var $el, icon, id;
      $el = $(el);
      id = $el.attr('id');
      icon = '<i class="fa fa-link"></i>';
      if (id) {
        return $el.append($("<a />").addClass("header-link").attr("href", "#" + id).html(icon));
      }
    });
  });

  // fix sidebar width in documentation
  $(function() {
    var $affixElement = $('div[data-spy="affix"]');
    $affixElement.width($affixElement.parent().width());
  });
</script>

<!-- Global Site Tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-50934829-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments)};
  gtag('js', new Date());

  gtag('config', 'UA-50934829-1');
</script>

</head>
<body style="padding-top: 100px">

  <nav class="navbar navbar-default navbar-fixed-top">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-items">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a href="/"><img id="nav-logo" alt="Apache Accumulo" class="img-responsive" src="/images/accumulo-logo.png" width="200"
        /></a>
    </div>
    <div class="collapse navbar-collapse" id="navbar-items">
      <ul class="nav navbar-nav">
        <li class="nav-link"><a href="/downloads">Download</a></li>
        <li class="nav-link"><a href="/tour">Tour</a></li>
        <li class="dropdown">
          <a class="dropdown-toggle" data-toggle="dropdown" href="#">Releases<span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="/release/accumulo-1.9.2/">1.9.2 (Latest)</a></li>
            <li><a href="/release/accumulo-1.7.4/">1.7.4</a></li>
            <li><a href="/release/">Archive</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a class="dropdown-toggle" data-toggle="dropdown" href="#">Documentation<span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="/quickstart-1.x">Quickstart (1.x)</a></li>
            <li><a href="/1.9/accumulo_user_manual.html">User Manual (1.9)</a></li>
            <li><a href="/1.9/apidocs">Javadocs (1.9)</a></li>
            <li><a href="/1.9/examples">Examples (1.9)</a></li>
            <li><a href="/features">Features</a></li>
            <li><a href="/glossary">Glossary</a></li>
            <li><a href="/external-docs">External Docs</a></li>
            <li><a href="/docs-archive/">Archive</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a class="dropdown-toggle" data-toggle="dropdown" href="#">Community<span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="/contact-us">Contact Us</a></li>
            <li><a href="/how-to-contribute">How To Contribute</a></li>
            <li><a href="/people">People</a></li>
            <li><a href="/related-projects">Related Projects</a></li>
          </ul>
        </li>
        <li class="nav-link"><a href="/search">Search</a></li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li class="dropdown">
          <a class="dropdown-toggle" data-toggle="dropdown" href="#"><img alt="Apache Software Foundation" src="https://www.apache.org/images/feather-small.png" width="70"/><span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="https://www.apache.org">Apache Homepage <i class="fa fa-external-link"></i></a></li>
            <li><a href="https://www.apache.org/licenses/">License <i class="fa fa-external-link"></i></a></li>
            <li><a href="https://www.apache.org/foundation/sponsorship">Sponsorship <i class="fa fa-external-link"></i></a></li>
            <li><a href="https://www.apache.org/security">Security <i class="fa fa-external-link"></i></a></li>
            <li><a href="https://www.apache.org/foundation/thanks">Thanks <i class="fa fa-external-link"></i></a></li>
            <li><a href="https://www.apache.org/foundation/policies/conduct">Code of Conduct <i class="fa fa-external-link"></i></a></li>
            <li><a href="https://www.apache.org/events/current-event.html">Current Event <i class="fa fa-external-link"></i></a></li>
          </ul>
        </li>
      </ul>
    </div>
  </div>
</nav>


  <div class="container">
    <div class="row">
      <div class="col-md-12">

        <div id="non-canonical" style="display: none; background-color: #F0E68C; padding-left: 1em;">
          Visit the official site at: <a href="https://accumulo.apache.org">https://accumulo.apache.org</a>
        </div>
        <div id="content">
          
          <div class="row">
  <div class="col-md-3">
    <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true" data-spy="affix">
      <div class="panel panel-default">
      
      
      
        
          
        
          
        
          
            <div class="panel-heading" role="tab" id="headingOne">
              <h4 class="panel-title">
                <a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapsegetting-started" aria-expanded="false" aria-controls="collapsegetting-started">
                  Getting started
                </a>
              </h4>
            </div>
            <div id="collapsegetting-started" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
              <div class="panel-body">
                
                
                <div class="row doc-sidebar-link"><a href="/docs/2.0/getting-started/design">Accumulo Design</a></div>
                
                <div class="row doc-sidebar-link"><a href="/docs/2.0/getting-started/quick-install">Quick Installation</a></div>
                
                <div class="row doc-sidebar-link"><a href="/docs/2.0/getting-started/clients">Accumulo Clients</a></div>
                
                <div class="row doc-sidebar-link"><a href="/docs/2.0/getting-started/shell">Accumulo Shell</a></div>
                
                <div class="row doc-sidebar-link"><a href="/docs/2.0/getting-started/table_design">Table Design</a></div>
                
                <div class="row doc-sidebar-link"><a href="/docs/2.0/getting-started/table_configuration">Table Configuration</a></div>
                
              </div>
            </div>
          
        
          
        
          
        
      
        
          
        
          
            <div class="panel-heading" role="tab" id="headingOne">
              <h4 class="panel-title">
                <a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapsedevelopment" aria-expanded="true" aria-controls="collapsedevelopment">
                  Development
                </a>
              </h4>
            </div>
            <div id="collapsedevelopment" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingOne">
              <div class="panel-body">
                
                
                <div class="row doc-sidebar-link"><a href="/docs/2.0/development/iterators">Iterators</a></div>
                
                <div class="row doc-sidebar-link"><a href="/docs/2.0/development/mapreduce">MapReduce</a></div>
                
                <div class="row doc-sidebar-link"><a href="/docs/2.0/development/proxy">Proxy</a></div>
                
                <div class="row doc-sidebar-link"><a href="/docs/2.0/development/development_tools">Development Tools</a></div>
                
                <div class="row doc-sidebar-link"><a href="/docs/2.0/development/sampling">Sampling</a></div>
                
                <div class="row doc-sidebar-link"><a href="/docs/2.0/development/summaries">Summary Statistics</a></div>
                
                <div class="row doc-sidebar-link"><a href="/docs/2.0/development/security">Security</a></div>
                
                <div class="row doc-sidebar-link"><a href="/docs/2.0/development/high_speed_ingest">High-Speed Ingest</a></div>
                
                <div class="row doc-sidebar-link"><a href="/docs/2.0/development/client-properties">Client Properties</a></div>
                
              </div>
            </div>
          
        
          
        
          
        
          
        
      
        
          
            <div class="panel-heading" role="tab" id="headingOne">
              <h4 class="panel-title">
                <a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseadministration" aria-expanded="false" aria-controls="collapseadministration">
                  Administration
                </a>
              </h4>
            </div>
            <div id="collapseadministration" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
              <div class="panel-body">
                
                
                <div class="row doc-sidebar-link"><a href="/docs/2.0/administration/in-depth-install">In-depth Installation</a></div>
                
                <div class="row doc-sidebar-link"><a href="/docs/2.0/administration/configuration-management">Configuration Management</a></div>
                
                <div class="row doc-sidebar-link"><a href="/docs/2.0/administration/properties">Server Properties</a></div>
                
                <div class="row doc-sidebar-link"><a href="/docs/2.0/administration/monitoring-metrics">Monitoring & Metrics</a></div>
                
                <div class="row doc-sidebar-link"><a href="/docs/2.0/administration/tracing">Tracing</a></div>
                
                <div class="row doc-sidebar-link"><a href="/docs/2.0/administration/fate">FATE</a></div>
                
                <div class="row doc-sidebar-link"><a href="/docs/2.0/administration/multivolume">Multi-Volume Installations</a></div>
                
                <div class="row doc-sidebar-link"><a href="/docs/2.0/administration/ssl">SSL</a></div>
                
                <div class="row doc-sidebar-link"><a href="/docs/2.0/administration/kerberos">Kerberos</a></div>
                
                <div class="row doc-sidebar-link"><a href="/docs/2.0/administration/replication">Replication</a></div>
                
                <div class="row doc-sidebar-link"><a href="/docs/2.0/administration/caching">Caching</a></div>
                
                <div class="row doc-sidebar-link"><a href="/docs/2.0/administration/upgrading">Upgrading Accumulo</a></div>
                
                <div class="row doc-sidebar-link"><a href="/docs/2.0/administration/scan-executors">Scan Executors</a></div>
                
                <div class="row doc-sidebar-link"><a href="/docs/2.0/administration/crypto">On Disk Encryption</a></div>
                
              </div>
            </div>
          
        
          
        
          
        
          
        
          
        
      
        
          
        
          
        
          
        
          
        
          
            <div class="panel-heading" role="tab" id="headingOne">
              <h4 class="panel-title">
                <a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapsetroubleshooting" aria-expanded="false" aria-controls="collapsetroubleshooting">
                  Troubleshooting
                </a>
              </h4>
            </div>
            <div id="collapsetroubleshooting" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
              <div class="panel-body">
                
                
                <div class="row doc-sidebar-link"><a href="/docs/2.0/troubleshooting/basic">Basic Troubleshooting</a></div>
                
                <div class="row doc-sidebar-link"><a href="/docs/2.0/troubleshooting/advanced">Advanced Troubleshooting</a></div>
                
                <div class="row doc-sidebar-link"><a href="/docs/2.0/troubleshooting/tools">Troubleshooting Tools</a></div>
                
                <div class="row doc-sidebar-link"><a href="/docs/2.0/troubleshooting/system-metadata-tables">System Metadata Tables</a></div>
                
                <div class="row doc-sidebar-link"><a href="/docs/2.0/troubleshooting/performance">Performance</a></div>
                
              </div>
            </div>
          
        
      
      </div>
    </div>
  </div>
  <div class="col-md-9">
    
    <p>Accumulo 2.0 documentation &nbsp;&gt;&gt;&nbsp; Development &nbsp;&gt;&gt;&nbsp; Proxy</p>
    

    <div class="alert alert-danger" style="margin-bottom: 0px;" role="alert">This documentation is for a future release of Accumulo! <a href="/1.9/accumulo_user_manual.html">View documentation for the latest release</a>.</div>

    <div class="row">
      <div class="col-md-10"><h1>Proxy</h1></div>
      <div class="col-md-2"><a class="pull-right" style="margin-top: 25px;" href="https://github.com/apache/accumulo-website/edit/master/_docs-2-0/development/proxy.md" role="button"><i class="glyphicon glyphicon-pencil"></i> <small>Edit this page</small></a></div>
    </div>

    <p>The proxy API allows the interaction with Accumulo with languages other than Java.
A proxy server is provided in the codebase and a client can further be generated.
The proxy API can also be used instead of the traditional <a href="https://static.javadoc.io/org.apache.accumulo/accumulo-core/1.9.2/org/apache/accumulo/core/client/AccumuloClient.html">AccumuloClient</a> class to
provide a single TCP port in which clients can be securely routed through a firewall,
without requiring access to all tablet servers in the cluster.</p>

<h2 id="prerequisites">Prerequisites</h2>

<p>The proxy server can live on any node in which the basic client API would work. That
means it must be able to communicate with the Master, ZooKeepers, NameNode, and the
DataNodes. A proxy client only needs the ability to communicate with the proxy server.</p>

<h2 id="running-the-proxy-server">Running the Proxy Server</h2>

<p>The proxy server is included in the Accumulo tarball distribution and can be run using
the <code class="highlighter-rouge">accumulo</code> command. The proxy is configured using <code class="highlighter-rouge">accumulo-client.properties</code> and
<code class="highlighter-rouge">proxy.properties</code> which can be found at <code class="highlighter-rouge">conf/templates/proxy.properties</code>. Create a
copy of this file and edit it for your environment:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cp ./conf/templates/proxy.properties ./conf/
vim ./conf/proxy.properties
</code></pre></div></div>

<p>At the very least, you need to configure the following properties:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>port=42424
protocolFactory=org.apache.thrift.protocol.TCompactProtocol$Factory
tokenClass=org.apache.accumulo.core.client.security.tokens.PasswordToken
</code></pre></div></div>

<p>After <code class="highlighter-rouge">proxy.properties</code> is configured, the proxy server can be started using the
<code class="highlighter-rouge">accumulo</code> command:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>accumulo proxy -p /path/to/proxy.properties -c /path/to/accumulo-client.properties &amp;
</code></pre></div></div>

<p>Logs will be output to the directory set by <code class="highlighter-rouge">ACCUMULO_LOG_DIR</code> in <code class="highlighter-rouge">accumulo-env.sh</code>.</p>

<h2 id="prerequisites-for-proxy-clients">Prerequisites for Proxy Clients</h2>

<p>Before you can run a proxy client, you will need the following:</p>

<ol>
  <li>Proxy client code generated for your language</li>
  <li>Thrift library installed for your language</li>
</ol>

<p>These requirements are described in detail below.</p>

<h3 id="proxy-client-code">Proxy client code</h3>

<p>The Accumulo tarball distribution ships with pre-generated client code for Python, Ruby, and C++ in
<code class="highlighter-rouge">lib/proxy</code>.</p>

<p>If you want to write a proxy in another language, you will need to install Thrift and generate
client code for you language using <code class="highlighter-rouge">lib/proxy/thrift/proxy.thrift</code>.  See the <a href="https://thrift.apache.org/tutorial/">Thrift Tutorial</a>
to how generate source from a thrift file.</p>

<h3 id="thrift-library">Thrift library</h3>

<p>Language-specific Thrift libraries can be installed using an OS or language package manager (i.e gem, pip, etc).
For example, <code class="highlighter-rouge">pip install thrift</code> will install Python-specific thrift libraries on your machine.</p>

<h2 id="proxy-client-examples">Proxy Client Examples</h2>

<p>The following examples show proxy clients written in Java, Ruby, and Python.</p>

<h3 id="java">Java</h3>

<p>After initiating a connection to the Proxy (see Apache Thrift’s documentation for examples
of connecting to a Thrift service), the methods on the proxy client will be available. The
first thing to do is log in:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Map</span> <span class="n">password</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;();</span>
<span class="n">password</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"password"</span><span class="o">,</span> <span class="s">"secret"</span><span class="o">);</span>
<span class="n">ByteBuffer</span> <span class="n">token</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">login</span><span class="o">(</span><span class="s">"root"</span><span class="o">,</span> <span class="n">password</span><span class="o">);</span>
</code></pre></div></div>

<p>Once logged in, the token returned will be used for most subsequent calls to the client.
Let’s create a table, add some data, scan the table, and delete it.</p>

<p>First, create a table.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">client</span><span class="o">.</span><span class="na">createTable</span><span class="o">(</span><span class="n">token</span><span class="o">,</span> <span class="s">"myTable"</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="n">TimeType</span><span class="o">.</span><span class="na">MILLIS</span><span class="o">);</span>
</code></pre></div></div>

<p>Next, add some data:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// first, create a writer on the server</span>
<span class="n">String</span> <span class="n">writer</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">createWriter</span><span class="o">(</span><span class="n">token</span><span class="o">,</span> <span class="s">"myTable"</span><span class="o">,</span> <span class="k">new</span> <span class="n">WriterOptions</span><span class="o">());</span>

<span class="c1">//rowid</span>
<span class="n">ByteBuffer</span> <span class="n">rowid</span> <span class="o">=</span> <span class="n">ByteBuffer</span><span class="o">.</span><span class="na">wrap</span><span class="o">(</span><span class="s">"UUID"</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>

<span class="c1">//mutation like class</span>
<span class="n">ColumnUpdate</span> <span class="n">cu</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ColumnUpdate</span><span class="o">();</span>
<span class="n">cu</span><span class="o">.</span><span class="na">setColFamily</span><span class="o">(</span><span class="s">"MyFamily"</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
<span class="n">cu</span><span class="o">.</span><span class="na">setColQualifier</span><span class="o">(</span><span class="s">"MyQualifier"</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
<span class="n">cu</span><span class="o">.</span><span class="na">setColVisibility</span><span class="o">(</span><span class="s">"VisLabel"</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
<span class="n">cu</span><span class="o">.</span><span class="na">setValue</span><span class="o">(</span><span class="s">"Some Value."</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>

<span class="n">List</span><span class="o">&lt;</span><span class="n">ColumnUpdate</span><span class="o">&gt;</span> <span class="n">updates</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">ColumnUpdate</span><span class="o">&gt;();</span>
<span class="n">updates</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">cu</span><span class="o">);</span>

<span class="c1">// build column updates</span>
<span class="n">Map</span><span class="o">&lt;</span><span class="n">ByteBuffer</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">ColumnUpdate</span><span class="o">&gt;&gt;</span> <span class="n">cellsToUpdate</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">ByteBuffer</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">ColumnUpdate</span><span class="o">&gt;&gt;();</span>
<span class="n">cellsToUpdate</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">rowid</span><span class="o">,</span> <span class="n">updates</span><span class="o">);</span>

<span class="c1">// send updates to the server</span>
<span class="n">client</span><span class="o">.</span><span class="na">updateAndFlush</span><span class="o">(</span><span class="n">writer</span><span class="o">,</span> <span class="s">"myTable"</span><span class="o">,</span> <span class="n">cellsToUpdate</span><span class="o">);</span>

<span class="n">client</span><span class="o">.</span><span class="na">closeWriter</span><span class="o">(</span><span class="n">writer</span><span class="o">);</span>
</code></pre></div></div>

<p>Scan for the data and batch the return of the results on the server:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">String</span> <span class="n">scanner</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">createScanner</span><span class="o">(</span><span class="n">token</span><span class="o">,</span> <span class="s">"myTable"</span><span class="o">,</span> <span class="k">new</span> <span class="n">ScanOptions</span><span class="o">());</span>
<span class="n">ScanResult</span> <span class="n">results</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">nextK</span><span class="o">(</span><span class="n">scanner</span><span class="o">,</span> <span class="mi">100</span><span class="o">);</span>

<span class="k">for</span><span class="o">(</span><span class="n">KeyValue</span> <span class="n">keyValue</span> <span class="o">:</span> <span class="n">results</span><span class="o">.</span><span class="na">getResultsIterator</span><span class="o">())</span> <span class="o">{</span>
  <span class="c1">// do something with results</span>
<span class="o">}</span>

<span class="n">client</span><span class="o">.</span><span class="na">closeScanner</span><span class="o">(</span><span class="n">scanner</span><span class="o">);</span>
</code></pre></div></div>

<h3 id="ruby">Ruby</h3>

<p>The example ruby code below can be run using the following command (the -I option is needed for ruby 1.9.x):</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ruby -I . client.rb &lt;host of server&gt;
</code></pre></div></div>

<p><strong>Warning:</strong> The script will connect to Accumulo, create a table, and add some rows to it.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'rubygems'</span>
<span class="nb">require</span> <span class="s1">'thrift'</span>
<span class="nb">require</span> <span class="s1">'accumulo_proxy'</span>

<span class="n">server</span> <span class="o">=</span> <span class="no">ARGV</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">||</span> <span class="s1">'localhost'</span>

<span class="n">socket</span> <span class="o">=</span> <span class="no">Thrift</span><span class="o">::</span><span class="no">Socket</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="mi">42424</span><span class="p">,</span> <span class="mi">9001</span><span class="p">)</span>
<span class="n">transport</span> <span class="o">=</span> <span class="no">Thrift</span><span class="o">::</span><span class="no">FramedTransport</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">socket</span><span class="p">)</span>
<span class="n">proto</span> <span class="o">=</span> <span class="no">Thrift</span><span class="o">::</span><span class="no">CompactProtocol</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">transport</span><span class="p">)</span>
<span class="n">proxy</span> <span class="o">=</span> <span class="no">Accumulo</span><span class="o">::</span><span class="no">AccumuloProxy</span><span class="o">::</span><span class="no">Client</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">proto</span><span class="p">)</span>

<span class="c1"># open up the connect</span>
<span class="n">transport</span><span class="p">.</span><span class="nf">open</span><span class="p">()</span>

<span class="c1"># Test if the server is up</span>
<span class="n">login</span> <span class="o">=</span> <span class="n">proxy</span><span class="p">.</span><span class="nf">login</span><span class="p">(</span><span class="s1">'root'</span><span class="p">,</span> <span class="p">{</span><span class="s1">'password'</span> <span class="o">=&gt;</span> <span class="s1">'secret'</span><span class="p">})</span>

<span class="c1"># print out a table list</span>
<span class="nb">puts</span> <span class="s2">"List of tables: </span><span class="si">#{</span><span class="n">proxy</span><span class="p">.</span><span class="nf">listTables</span><span class="p">(</span><span class="n">login</span><span class="p">).</span><span class="nf">inspect</span><span class="si">}</span><span class="s2">"</span>

<span class="n">testtable</span> <span class="o">=</span> <span class="s2">"rubytest"</span>
<span class="n">proxy</span><span class="p">.</span><span class="nf">createTable</span><span class="p">(</span><span class="n">login</span><span class="p">,</span> <span class="n">testtable</span><span class="p">,</span> <span class="kp">true</span><span class="p">,</span> <span class="no">Accumulo</span><span class="o">::</span><span class="no">TimeType</span><span class="o">::</span><span class="no">MILLIS</span><span class="p">)</span> <span class="k">unless</span> <span class="n">proxy</span><span class="p">.</span><span class="nf">tableExists</span><span class="p">(</span><span class="n">login</span><span class="p">,</span><span class="n">testtable</span><span class="p">)</span> 

<span class="n">update1</span> <span class="o">=</span> <span class="no">Accumulo</span><span class="o">::</span><span class="no">ColumnUpdate</span><span class="p">.</span><span class="nf">new</span><span class="p">({</span><span class="s1">'colFamily'</span> <span class="o">=&gt;</span> <span class="s2">"cf1"</span><span class="p">,</span> <span class="s1">'colQualifier'</span> <span class="o">=&gt;</span> <span class="s2">"cq1"</span><span class="p">,</span> <span class="s1">'value'</span><span class="o">=&gt;</span> <span class="s2">"a"</span><span class="p">})</span>
<span class="n">update2</span> <span class="o">=</span> <span class="no">Accumulo</span><span class="o">::</span><span class="no">ColumnUpdate</span><span class="p">.</span><span class="nf">new</span><span class="p">({</span><span class="s1">'colFamily'</span> <span class="o">=&gt;</span> <span class="s2">"cf2"</span><span class="p">,</span> <span class="s1">'colQualifier'</span> <span class="o">=&gt;</span> <span class="s2">"cq2"</span><span class="p">,</span> <span class="s1">'value'</span><span class="o">=&gt;</span> <span class="s2">"b"</span><span class="p">})</span>
<span class="n">proxy</span><span class="p">.</span><span class="nf">updateAndFlush</span><span class="p">(</span><span class="n">login</span><span class="p">,</span><span class="n">testtable</span><span class="p">,{</span><span class="s1">'row1'</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="n">update1</span><span class="p">,</span><span class="n">update2</span><span class="p">]})</span>

<span class="n">cookie</span> <span class="o">=</span> <span class="n">proxy</span><span class="p">.</span><span class="nf">createScanner</span><span class="p">(</span><span class="n">login</span><span class="p">,</span><span class="n">testtable</span><span class="p">,</span><span class="kp">nil</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">proxy</span><span class="p">.</span><span class="nf">nextK</span><span class="p">(</span><span class="n">cookie</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">result</span><span class="p">.</span><span class="nf">results</span><span class="p">.</span><span class="nf">each</span><span class="p">{</span> <span class="o">|</span><span class="n">keyvalue</span><span class="o">|</span> <span class="nb">puts</span> <span class="s2">"Key: </span><span class="si">#{</span><span class="n">keyvalue</span><span class="p">.</span><span class="nf">key</span><span class="p">.</span><span class="nf">inspect</span><span class="si">}</span><span class="s2"> Value: </span><span class="si">#{</span><span class="n">keyvalue</span><span class="p">.</span><span class="nf">value</span><span class="si">}</span><span class="s2">"</span> <span class="p">}</span>
</code></pre></div></div>

<h3 id="python">Python</h3>

<p>The example python client code below (if saved to TestClient.py) can be run using the following command:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PYTHONPATH=/path/to/accumulo-2.0.0/lib/proxy/gen-py python TestClient.py
</code></pre></div></div>

<p>As a warning, this script will create a table in your Accumulo instance and add a few cells to it.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#! /usr/bin/env python</span>

<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">from</span> <span class="nn">thrift</span> <span class="kn">import</span> <span class="n">Thrift</span>
<span class="kn">from</span> <span class="nn">thrift.transport</span> <span class="kn">import</span> <span class="n">TSocket</span>
<span class="kn">from</span> <span class="nn">thrift.transport</span> <span class="kn">import</span> <span class="n">TTransport</span>
<span class="kn">from</span> <span class="nn">thrift.protocol</span> <span class="kn">import</span> <span class="n">TCompactProtocol</span>

<span class="kn">from</span> <span class="nn">accumulo</span> <span class="kn">import</span> <span class="n">AccumuloProxy</span>
<span class="kn">from</span> <span class="nn">accumulo.ttypes</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">transport</span> <span class="o">=</span> <span class="n">TSocket</span><span class="o">.</span><span class="n">TSocket</span><span class="p">(</span><span class="s">'localhost'</span><span class="p">,</span> <span class="mi">42424</span><span class="p">)</span>
<span class="n">transport</span> <span class="o">=</span> <span class="n">TTransport</span><span class="o">.</span><span class="n">TFramedTransport</span><span class="p">(</span><span class="n">transport</span><span class="p">)</span>
<span class="n">protocol</span> <span class="o">=</span> <span class="n">TCompactProtocol</span><span class="o">.</span><span class="n">TCompactProtocol</span><span class="p">(</span><span class="n">transport</span><span class="p">)</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">AccumuloProxy</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">protocol</span><span class="p">)</span>
<span class="n">transport</span><span class="o">.</span><span class="nb">open</span><span class="p">()</span>

<span class="n">login</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="s">'root'</span><span class="p">,</span> <span class="p">{</span><span class="s">'password'</span><span class="p">:</span><span class="s">'secret'</span><span class="p">})</span>

<span class="k">print</span> <span class="n">client</span><span class="o">.</span><span class="n">listTables</span><span class="p">(</span><span class="n">login</span><span class="p">)</span>

<span class="n">testtable</span> <span class="o">=</span> <span class="s">"pythontest"</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">client</span><span class="o">.</span><span class="n">tableExists</span><span class="p">(</span><span class="n">login</span><span class="p">,</span> <span class="n">testtable</span><span class="p">):</span>
    <span class="n">client</span><span class="o">.</span><span class="n">createTable</span><span class="p">(</span><span class="n">login</span><span class="p">,</span> <span class="n">testtable</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="n">TimeType</span><span class="o">.</span><span class="n">MILLIS</span><span class="p">)</span>

<span class="n">row1</span> <span class="o">=</span> <span class="p">{</span><span class="s">'a'</span><span class="p">:[</span><span class="n">ColumnUpdate</span><span class="p">(</span><span class="s">'a'</span><span class="p">,</span><span class="s">'a'</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="s">'value1'</span><span class="p">),</span> <span class="n">ColumnUpdate</span><span class="p">(</span><span class="s">'b'</span><span class="p">,</span><span class="s">'b'</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="s">'value2'</span><span class="p">)]}</span>
<span class="n">client</span><span class="o">.</span><span class="n">updateAndFlush</span><span class="p">(</span><span class="n">login</span><span class="p">,</span> <span class="n">testtable</span><span class="p">,</span> <span class="n">row1</span><span class="p">)</span>

<span class="n">cookie</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">createScanner</span><span class="p">(</span><span class="n">login</span><span class="p">,</span> <span class="n">testtable</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
<span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">client</span><span class="o">.</span><span class="n">nextK</span><span class="p">(</span><span class="n">cookie</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">results</span><span class="p">:</span>
   <span class="k">print</span> <span class="n">entry</span>
</code></pre></div></div>

<p>The example code below shows proxy client code for managing namespaces:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#! /usr/bin/env python</span>

<span class="kn">from</span> <span class="nn">thrift.protocol</span> <span class="kn">import</span> <span class="n">TCompactProtocol</span>
<span class="kn">from</span> <span class="nn">thrift.transport</span> <span class="kn">import</span> <span class="n">TSocket</span><span class="p">,</span> <span class="n">TTransport</span>

<span class="kn">from</span> <span class="nn">proxy</span> <span class="kn">import</span> <span class="n">AccumuloProxy</span>
<span class="kn">from</span> <span class="nn">proxy.ttypes</span> <span class="kn">import</span> <span class="n">NamespacePermission</span><span class="p">,</span> <span class="n">IteratorSetting</span><span class="p">,</span> <span class="n">IteratorScope</span><span class="p">,</span> <span class="n">AccumuloException</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">transport</span> <span class="o">=</span> <span class="n">TSocket</span><span class="o">.</span><span class="n">TSocket</span><span class="p">(</span><span class="s">'localhost'</span><span class="p">,</span> <span class="mi">42424</span><span class="p">)</span>
    <span class="n">transport</span> <span class="o">=</span> <span class="n">TTransport</span><span class="o">.</span><span class="n">TFramedTransport</span><span class="p">(</span><span class="n">transport</span><span class="p">)</span>
    <span class="n">protocol</span> <span class="o">=</span> <span class="n">TCompactProtocol</span><span class="o">.</span><span class="n">TCompactProtocol</span><span class="p">(</span><span class="n">transport</span><span class="p">)</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">AccumuloProxy</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">protocol</span><span class="p">)</span>
    <span class="n">transport</span><span class="o">.</span><span class="nb">open</span><span class="p">()</span>
    <span class="n">login</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="s">'root'</span><span class="p">,</span> <span class="p">{</span><span class="s">'password'</span><span class="p">:</span> <span class="s">'password'</span><span class="p">})</span>

    <span class="n">client</span><span class="o">.</span><span class="n">createLocalUser</span><span class="p">(</span><span class="n">login</span><span class="p">,</span> <span class="s">'user1'</span><span class="p">,</span> <span class="s">'password1'</span><span class="p">)</span>

    <span class="k">print</span> <span class="n">client</span><span class="o">.</span><span class="n">listNamespaces</span><span class="p">(</span><span class="n">login</span><span class="p">)</span>

    <span class="c"># create a namespace and give the user1 all permissions</span>
    <span class="k">print</span> <span class="s">'creating namespace testing'</span>
    <span class="n">client</span><span class="o">.</span><span class="n">createNamespace</span><span class="p">(</span><span class="n">login</span><span class="p">,</span> <span class="s">'testing'</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">client</span><span class="o">.</span><span class="n">namespaceExists</span><span class="p">(</span><span class="n">login</span><span class="p">,</span> <span class="s">'testing'</span><span class="p">)</span>
    <span class="k">print</span> <span class="n">client</span><span class="o">.</span><span class="n">listNamespaces</span><span class="p">(</span><span class="n">login</span><span class="p">)</span>

    <span class="k">print</span> <span class="s">'testing namespace renaming'</span>
    <span class="n">client</span><span class="o">.</span><span class="n">renameNamespace</span><span class="p">(</span><span class="n">login</span><span class="p">,</span> <span class="s">'testing'</span><span class="p">,</span> <span class="s">'testing2'</span><span class="p">)</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">client</span><span class="o">.</span><span class="n">namespaceExists</span><span class="p">(</span><span class="n">login</span><span class="p">,</span> <span class="s">'testing'</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">client</span><span class="o">.</span><span class="n">namespaceExists</span><span class="p">(</span><span class="n">login</span><span class="p">,</span> <span class="s">'testing2'</span><span class="p">)</span>
    <span class="n">client</span><span class="o">.</span><span class="n">renameNamespace</span><span class="p">(</span><span class="n">login</span><span class="p">,</span> <span class="s">'testing2'</span><span class="p">,</span> <span class="s">'testing'</span><span class="p">)</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">client</span><span class="o">.</span><span class="n">namespaceExists</span><span class="p">(</span><span class="n">login</span><span class="p">,</span> <span class="s">'testing2'</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">client</span><span class="o">.</span><span class="n">namespaceExists</span><span class="p">(</span><span class="n">login</span><span class="p">,</span> <span class="s">'testing'</span><span class="p">)</span>

    <span class="k">print</span> <span class="s">'granting all namespace permissions to user1'</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">NamespacePermission</span><span class="o">.</span><span class="n">_VALUES_TO_NAMES</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">client</span><span class="o">.</span><span class="n">grantNamespacePermission</span><span class="p">(</span><span class="n">login</span><span class="p">,</span> <span class="s">'user1'</span><span class="p">,</span> <span class="s">'testing'</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>

    <span class="c"># make sure the last operation worked</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">NamespacePermission</span><span class="o">.</span><span class="n">_VALUES_TO_NAMES</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="k">assert</span> <span class="n">client</span><span class="o">.</span><span class="n">hasNamespacePermission</span><span class="p">(</span><span class="n">login</span><span class="p">,</span> <span class="s">'user1'</span><span class="p">,</span> <span class="s">'testing'</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> \
            <span class="s">'user1 does</span><span class="se">\'</span><span class="s">nt have namespace permission </span><span class="si">%</span><span class="s">s'</span> <span class="o">%</span> <span class="n">v</span>

    <span class="k">print</span> <span class="s">'default namespace: '</span> <span class="o">+</span> <span class="n">client</span><span class="o">.</span><span class="n">defaultNamespace</span><span class="p">()</span>
    <span class="k">print</span> <span class="s">'system namespace: '</span> <span class="o">+</span> <span class="n">client</span><span class="o">.</span><span class="n">systemNamespace</span><span class="p">()</span>

    <span class="c"># grab the namespace properties</span>
    <span class="k">print</span> <span class="s">'retrieving namespace properties'</span>
    <span class="n">props</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">getNamespaceProperties</span><span class="p">(</span><span class="n">login</span><span class="p">,</span> <span class="s">'testing'</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">props</span> <span class="ow">and</span> <span class="n">props</span><span class="p">[</span><span class="s">'table.compaction.major.ratio'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'3'</span>

    <span class="c"># update a property and verify it is good</span>
    <span class="k">print</span> <span class="s">'setting namespace property table.compaction.major.ratio = 4'</span>
    <span class="n">client</span><span class="o">.</span><span class="n">setNamespaceProperty</span><span class="p">(</span><span class="n">login</span><span class="p">,</span> <span class="s">'testing'</span><span class="p">,</span> <span class="s">'table.compaction.major.ratio'</span><span class="p">,</span> <span class="s">'4'</span><span class="p">)</span>
    <span class="n">props</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">getNamespaceProperties</span><span class="p">(</span><span class="n">login</span><span class="p">,</span> <span class="s">'testing'</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">props</span> <span class="ow">and</span> <span class="n">props</span><span class="p">[</span><span class="s">'table.compaction.major.ratio'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'4'</span>

    <span class="k">print</span> <span class="s">'retrieving namespace ID map'</span>
    <span class="n">nsids</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">namespaceIdMap</span><span class="p">(</span><span class="n">login</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">nsids</span> <span class="ow">and</span> <span class="s">'accumulo'</span> <span class="ow">in</span> <span class="n">nsids</span>

    <span class="k">print</span> <span class="s">'attaching debug iterator to namespace testing'</span>
    <span class="n">setting</span> <span class="o">=</span> <span class="n">IteratorSetting</span><span class="p">(</span><span class="n">priority</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'DebugTheThings'</span><span class="p">,</span>
                              <span class="n">iteratorClass</span><span class="o">=</span><span class="s">'org.apache.accumulo.core.iterators.DebugIterator'</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="p">{})</span>
    <span class="n">client</span><span class="o">.</span><span class="n">attachNamespaceIterator</span><span class="p">(</span><span class="n">login</span><span class="p">,</span> <span class="s">'testing'</span><span class="p">,</span> <span class="n">setting</span><span class="p">,</span> <span class="p">[</span><span class="n">IteratorScope</span><span class="o">.</span><span class="n">SCAN</span><span class="p">])</span>
    <span class="n">setting</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">getNamespaceIteratorSetting</span><span class="p">(</span><span class="n">login</span><span class="p">,</span> <span class="s">'testing'</span><span class="p">,</span> <span class="s">'DebugTheThings'</span><span class="p">,</span> <span class="n">IteratorScope</span><span class="o">.</span><span class="n">SCAN</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">setting</span> <span class="ow">and</span> <span class="n">setting</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">'DebugTheThings'</span>

    <span class="c"># make sure the iterator is in the list</span>
    <span class="n">iters</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">listNamespaceIterators</span><span class="p">(</span><span class="n">login</span><span class="p">,</span> <span class="s">'testing'</span><span class="p">)</span>
    <span class="n">found</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">scopes</span> <span class="ow">in</span> <span class="n">iters</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s">'DebugTheThings'</span><span class="p">:</span>
            <span class="n">found</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">break</span>
    <span class="k">assert</span> <span class="n">found</span>

    <span class="k">print</span> <span class="s">'checking for iterator conflicts'</span>

    <span class="c"># this next statment should be fine since we are on a different scope</span>
    <span class="n">client</span><span class="o">.</span><span class="n">checkNamespaceIteratorConflicts</span><span class="p">(</span><span class="n">login</span><span class="p">,</span> <span class="s">'testing'</span><span class="p">,</span> <span class="n">setting</span><span class="p">,</span> <span class="p">[</span><span class="n">IteratorScope</span><span class="o">.</span><span class="n">MINC</span><span class="p">])</span>

    <span class="c"># this time it should throw an exception since we have already added the iterator with this scope</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">client</span><span class="o">.</span><span class="n">checkNamespaceIteratorConflicts</span><span class="p">(</span><span class="n">login</span><span class="p">,</span> <span class="s">'testing'</span><span class="p">,</span> <span class="n">setting</span><span class="p">,</span> <span class="p">[</span><span class="n">IteratorScope</span><span class="o">.</span><span class="n">SCAN</span><span class="p">,</span> <span class="n">IteratorScope</span><span class="o">.</span><span class="n">MINC</span><span class="p">])</span>
    <span class="k">except</span> <span class="n">AccumuloException</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="bp">False</span><span class="p">,</span> <span class="s">'There should have been a namespace iterator conflict!'</span>

    <span class="k">print</span> <span class="s">'removing debug iterator from namespace testing'</span>
    <span class="n">client</span><span class="o">.</span><span class="n">removeNamespaceIterator</span><span class="p">(</span><span class="n">login</span><span class="p">,</span> <span class="s">'testing'</span><span class="p">,</span> <span class="s">'DebugTheThings'</span><span class="p">,</span> <span class="p">[</span><span class="n">IteratorScope</span><span class="o">.</span><span class="n">SCAN</span><span class="p">])</span>

    <span class="c"># make sure the iterator is NOT in the list anymore</span>
    <span class="n">iters</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">listNamespaceIterators</span><span class="p">(</span><span class="n">login</span><span class="p">,</span> <span class="s">'testing'</span><span class="p">)</span>
    <span class="n">found</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">scopes</span> <span class="ow">in</span> <span class="n">iters</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s">'DebugTheThings'</span><span class="p">:</span>
            <span class="n">found</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">break</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">found</span>

    <span class="k">print</span> <span class="s">'adding max mutation size namespace constraint'</span>
    <span class="n">constraintid</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">addNamespaceConstraint</span><span class="p">(</span><span class="n">login</span><span class="p">,</span> <span class="s">'testing'</span><span class="p">,</span>
                                                 <span class="s">'org.apache.accumulo.test.constraints.MaxMutationSize'</span><span class="p">)</span>

    <span class="k">print</span> <span class="s">'make sure constraint was added'</span>
    <span class="n">constraints</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">listNamespaceConstraints</span><span class="p">(</span><span class="n">login</span><span class="p">,</span> <span class="s">'testing'</span><span class="p">)</span>
    <span class="n">found</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">cid</span> <span class="ow">in</span> <span class="n">constraints</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">cid</span> <span class="o">==</span> <span class="n">constraintid</span> <span class="ow">and</span> <span class="n">name</span> <span class="o">==</span> <span class="s">'org.apache.accumulo.test.constraints.MaxMutationSize'</span><span class="p">:</span>
            <span class="n">found</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">break</span>
    <span class="k">assert</span> <span class="n">found</span>

    <span class="k">print</span> <span class="s">'remove max mutation size namespace constraint'</span>
    <span class="n">client</span><span class="o">.</span><span class="n">removeNamespaceConstraint</span><span class="p">(</span><span class="n">login</span><span class="p">,</span> <span class="s">'testing'</span><span class="p">,</span> <span class="n">constraintid</span><span class="p">)</span>

    <span class="k">print</span> <span class="s">'make sure constraint was removed'</span>
    <span class="n">constraints</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">listNamespaceConstraints</span><span class="p">(</span><span class="n">login</span><span class="p">,</span> <span class="s">'testing'</span><span class="p">)</span>
    <span class="n">found</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">cid</span> <span class="ow">in</span> <span class="n">constraints</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">cid</span> <span class="o">==</span> <span class="n">constraintid</span> <span class="ow">and</span> <span class="n">name</span> <span class="o">==</span> <span class="s">'org.apache.accumulo.test.constraints.MaxMutationSize'</span><span class="p">:</span>
            <span class="n">found</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">break</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">found</span>

    <span class="k">print</span> <span class="s">'test a namespace class load of the VersioningIterator'</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">testNamespaceClassLoad</span><span class="p">(</span><span class="n">login</span><span class="p">,</span> <span class="s">'testing'</span><span class="p">,</span> <span class="s">'org.apache.accumulo.core.iterators.user.VersioningIterator'</span><span class="p">,</span>
                                        <span class="s">'org.apache.accumulo.core.iterators.SortedKeyValueIterator'</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">res</span>

    <span class="k">print</span> <span class="s">'test a bad namespace class load of the VersioningIterator'</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">testNamespaceClassLoad</span><span class="p">(</span><span class="n">login</span><span class="p">,</span> <span class="s">'testing'</span><span class="p">,</span> <span class="s">'org.apache.accumulo.core.iterators.user.VersioningIterator'</span><span class="p">,</span>
                                        <span class="s">'dummy'</span><span class="p">)</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">res</span>

    <span class="c"># revoke the permissions</span>
    <span class="k">print</span> <span class="s">'revoking namespace permissions for user1'</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">NamespacePermission</span><span class="o">.</span><span class="n">_VALUES_TO_NAMES</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">client</span><span class="o">.</span><span class="n">revokeNamespacePermission</span><span class="p">(</span><span class="n">login</span><span class="p">,</span> <span class="s">'user1'</span><span class="p">,</span> <span class="s">'testing'</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>

    <span class="c"># make sure the last operation worked</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">NamespacePermission</span><span class="o">.</span><span class="n">_VALUES_TO_NAMES</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">client</span><span class="o">.</span><span class="n">hasNamespacePermission</span><span class="p">(</span><span class="n">login</span><span class="p">,</span> <span class="s">'user1'</span><span class="p">,</span> <span class="s">'testing'</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> \
            <span class="s">'user1 does</span><span class="se">\'</span><span class="s">nt have namespace permission </span><span class="si">%</span><span class="s">s'</span> <span class="o">%</span> <span class="n">v</span>

    <span class="k">print</span> <span class="s">'deleting namespace testing'</span>
    <span class="n">client</span><span class="o">.</span><span class="n">deleteNamespace</span><span class="p">(</span><span class="n">login</span><span class="p">,</span> <span class="s">'testing'</span><span class="p">)</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">client</span><span class="o">.</span><span class="n">namespaceExists</span><span class="p">(</span><span class="n">login</span><span class="p">,</span> <span class="s">'testing'</span><span class="p">)</span>

    <span class="k">print</span> <span class="s">'deleting user1'</span>
    <span class="n">client</span><span class="o">.</span><span class="n">dropLocalUser</span><span class="p">(</span><span class="n">login</span><span class="p">,</span> <span class="s">'user1'</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</code></pre></div></div>



    <div class="row" style="margin-top: 20px;">
      <div class="col-md-10"><strong>Find documentation for all releases in the <a href="/docs-archive">archive</strong></div>
      <div class="col-md-2"><a class="pull-right" href="https://github.com/apache/accumulo-website/edit/master/_docs-2-0/development/proxy.md" role="button"><i class="glyphicon glyphicon-pencil"></i> <small>Edit this page</small></a></div>
    </div>  
  </div>
</div>

        </div>

        
<footer>

  <p><a href="https://www.apache.org/foundation/contributing"><img src="https://www.apache.org/images/SupportApache-small.png" alt="Support the ASF" id="asf-logo" height="100" /></a></p>

  <p>Copyright © 2011-2018 <a href="https://www.apache.org">The Apache Software Foundation</a>.
Licensed under the <a href="https://www.apache.org/licenses/">Apache License, Version 2.0</a>.</p>

  <p>Apache®, the names of Apache projects and their logos, and the multicolor feather
logo are registered trademarks or trademarks of The Apache Software Foundation
in the United States and/or other countries.</p>

</footer>


      </div>
    </div>
  </div>
</body>
</html>
