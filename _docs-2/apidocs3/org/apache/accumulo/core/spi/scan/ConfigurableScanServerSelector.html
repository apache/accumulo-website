<!DOCTYPE HTML>
<html lang="en">
<head>
<!-- Generated by javadoc (17) -->
<title>ConfigurableScanServerSelector (Apache Accumulo Project 3.0.0 API)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="description" content="declaration: package: org.apache.accumulo.core.spi.scan, class: ConfigurableScanServerSelector">
<meta name="generator" content="javadoc/ClassWriterImpl">
<link rel="stylesheet" type="text/css" href="../../../../../../stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../../../script-dir/jquery-ui.min.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../../../jquery-ui.overrides.css" title="Style">
<script type="text/javascript" src="../../../../../../script.js"></script>
<script type="text/javascript" src="../../../../../../script-dir/jquery-3.6.1.min.js"></script>
<script type="text/javascript" src="../../../../../../script-dir/jquery-ui.min.js"></script>
</head>
<body class="class-declaration-page">
<script type="text/javascript">var evenRowColor = "even-row-color";
var oddRowColor = "odd-row-color";
var tableTab = "table-tab";
var activeTableTab = "active-table-tab";
var pathtoroot = "../../../../../../";
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<div class="flex-box">
<header role="banner" class="flex-header">
<nav role="navigation">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="top-nav" id="navbar-top">
<div class="skip-nav"><a href="#skip-navbar-top" title="Skip navigation links">Skip navigation links</a></div>
<ul id="navbar-top-firstrow" class="nav-list" title="Navigation">
<li><a href="../../../../../../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="nav-bar-cell1-rev">Class</li>
<li><a href="class-use/ConfigurableScanServerSelector.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../../help-doc.html#class">Help</a></li>
</ul>
</div>
<div class="sub-nav">
<div>
<ul class="sub-nav-list">
<li>Summary:&nbsp;</li>
<li><a href="#nested-class-summary">Nested</a>&nbsp;|&nbsp;</li>
<li><a href="#field-summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor-summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method-summary">Method</a></li>
</ul>
<ul class="sub-nav-list">
<li>Detail:&nbsp;</li>
<li><a href="#field-detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor-detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method-detail">Method</a></li>
</ul>
</div>
<div class="nav-list-search"><label for="search-input">SEARCH:</label>
<input type="text" id="search-input" value="search" disabled="disabled">
<input type="reset" id="reset-button" value="reset" disabled="disabled">
</div>
</div>
<!-- ========= END OF TOP NAVBAR ========= -->
<span class="skip-nav" id="skip-navbar-top"></span></nav>
</header>
<div class="flex-content">
<main role="main">
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="sub-title"><span class="package-label-in-type">Package</span>&nbsp;<a href="package-summary.html">org.apache.accumulo.core.spi.scan</a></div>
<h1 title="Class ConfigurableScanServerSelector" class="title">Class ConfigurableScanServerSelector</h1>
</div>
<div class="inheritance" title="Inheritance Tree"><a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">java.lang.Object</a>
<div class="inheritance">org.apache.accumulo.core.spi.scan.ConfigurableScanServerSelector</div>
</div>
<section class="class-description" id="class-description">
<dl class="notes">
<dt>All Implemented Interfaces:</dt>
<dd><code><a href="ScanServerSelector.html" title="interface in org.apache.accumulo.core.spi.scan">ScanServerSelector</a></code></dd>
</dl>
<hr>
<div class="type-signature"><span class="modifiers">public class </span><span class="element-name type-name-label">ConfigurableScanServerSelector</span>
<span class="extends-implements">extends <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a>
implements <a href="ScanServerSelector.html" title="interface in org.apache.accumulo.core.spi.scan">ScanServerSelector</a></span></div>
<div class="block">The default Accumulo selector for scan servers. This dispatcher will :

 <ul>
 <li>Hash each tablet to a per attempt configurable number of scan servers and then randomly
 choose one of those scan servers. Using hashing allows different client to select the same scan
 servers for a given tablet.</li>
 <li>Use a per attempt configurable busy timeout.</li>
 </ul>

 <p>
 This class accepts a single configuration that has a json value. To configure this class set
 <code>scan.server.selector.opts.profiles=&lt;json&gt;</code> in the accumulo client configuration along with
 the config for the class. The following is the default configuration value.
 </p>
 <p>
 <a href="#PROFILES_DEFAULT">"[{\'isDefault\':true,\'maxBusyTimeout\':\'5m\',\'busyTimeoutMultiplier\':8, \'scanTypeActivations\':[], \'attemptPlans\':[{\'servers\':\'3\', \'busyTimeout\':\'33ms\', \'salt\':\'one\'},{\'servers\':\'13\', \'busyTimeout\':\'33ms\', \'salt\':\'two\'},{\'servers\':\'100%\', \'busyTimeout\':\'33ms\'}]}]"</a>
 </p>

 The json is structured as a list of profiles, with each profile having the following fields.

 <ul>
 <li><b>isDefault : </b> A boolean that specifies whether this is the default profile. One and
 only one profile must set this to true.</li>
 <li><b>maxBusyTimeout : </b> The maximum busy timeout to use. The busy timeout from the last
 attempt configuration grows exponentially up to this max.</li>
 <li><b>scanTypeActivations : </b> A list of scan types that will activate this profile. Scan
 types are specified by setting <code>scan_type=&lt;scan_type&gt;</code> as execution on the scanner. See
 <a href="../../client/ScannerBase.html#setExecutionHints(java.util.Map)"><code>ScannerBase.setExecutionHints(Map)</code></a></li>
 <li><b>group : </b> Scan servers can be started with an optional group. If specified, this option
 will limit the scan servers used to those that were started with this group name. If not
 specified, the set of scan servers that did not specify a group will be used. Grouping scan
 servers supports at least two use cases. First groups can be used to dedicate resources for
 certain scans. Second groups can be used to have different hardware/VM types for scans, for
 example could have some scans use expensive high memory VMs and others use cheaper burstable VMs.
 <li><b>attemptPlans : </b> A list of configuration to use for each scan attempt. Each list object
 has the following fields:
 <ul>
 <li><b>servers : </b> The number of servers to randomly choose from for this attempt.</li>
 <li><b>busyTimeout : </b> The busy timeout to use for this attempt.</li>
 <li><b>salt : </b> An optional string to append when hashing the tablet. When this is set
 differently for attempts it has the potential to cause the set of servers chosen from to be
 disjoint. When not set or the same, the servers between attempts will be subsets.</li>
 </ul>
 </li>
 </ul>

 <p>
 Below is an example configuration with two profiles, one is the default and the other is used
 when the scan execution hint <code>scan_type=slow</code> is set.
 </p>

 <pre>
    [
     {
       "isDefault":true,
       "maxBusyTimeout":"5m",
       "busyTimeoutMultiplier":4,
       "attemptPlans":[
         {"servers":"3", "busyTimeout":"33ms"},
         {"servers":"100%", "busyTimeout":"100ms"}
       ]
     },
     {
       "scanTypeActivations":["slow"],
       "maxBusyTimeout":"20m",
       "busyTimeoutMultiplier":8,
       "group":"lowcost",
       "attemptPlans":[
         {"servers":"1", "busyTimeout":"10s"},
         {"servers":"3", "busyTimeout":"30s","salt":"42"},
         {"servers":"9", "busyTimeout":"60s","salt":"84"}
       ]
     }
    ]
 </pre>

 <p>
 For the default profile in the example it will start off by choosing randomly from 3 scan servers
 based on a hash of the tablet with no salt. For the first attempt it will use a busy timeout of
 33 milliseconds. If the first attempt returns with busy, then it will randomly choose from 100%
 or all servers for the second attempt and use a busy timeout of 100ms. For subsequent attempts it
 will keep choosing from all servers and start multiplying the busy timeout by 4 until the max
 busy timeout of 4 minutes is reached.
 </p>

 <p>
 For the profile activated by <code>scan_type=slow</code> it start off by choosing randomly from 1 scan
 server based on a hash of the tablet with no salt and a busy timeout of 10s. The second attempt
 will choose from 3 scan servers based on a hash of the tablet plus the salt 42.
 Without the salt, the single scan servers from the first attempt would always be included in the
 set of 3. With the salt the single scan server from the first attempt may not be included. The
 third attempt will choose a scan server from 9 using the salt 84 and a busy timeout of
 60s. The different salt means the set of servers that attempts 2 and 3 choose from may be
 disjoint. Attempt 4 and greater will continue to choose from the same 9 servers as attempt 3 and
 will keep increasing the busy timeout by multiplying 8 until the maximum of 20 minutes is
 reached. For this profile it will choose from scan servers in the group lowcost.
 </p></div>
<dl class="notes">
<dt>Since:</dt>
<dd>2.1.0</dd>
</dl>
</section>
<section class="summary">
<ul class="summary-list">
<!-- ======== NESTED CLASS SUMMARY ======== -->
<li>
<section class="nested-class-summary" id="nested-class-summary">
<h2>Nested Class Summary</h2>
<div class="inherited-list">
<h2 id="nested-classes-inherited-from-class-org.apache.accumulo.core.spi.scan.ScanServerSelector">Nested classes/interfaces inherited from interface&nbsp;org.apache.accumulo.core.spi.scan.<a href="ScanServerSelector.html" title="interface in org.apache.accumulo.core.spi.scan">ScanServerSelector</a></h2>
<code><a href="ScanServerSelector.InitParameters.html" title="interface in org.apache.accumulo.core.spi.scan">ScanServerSelector.InitParameters</a>, <a href="ScanServerSelector.SelectorParameters.html" title="interface in org.apache.accumulo.core.spi.scan">ScanServerSelector.SelectorParameters</a></code></div>
</section>
</li>
<!-- =========== FIELD SUMMARY =========== -->
<li>
<section class="field-summary" id="field-summary">
<h2>Field Summary</h2>
<div class="caption"><span>Fields</span></div>
<div class="summary-table three-column-summary">
<div class="table-header col-first">Modifier and Type</div>
<div class="table-header col-second">Field</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color"><code>static final <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a></code></div>
<div class="col-second even-row-color"><code><a href="#PROFILES_DEFAULT" class="member-name-link">PROFILES_DEFAULT</a></code></div>
<div class="col-last even-row-color">&nbsp;</div>
</div>
<div class="inherited-list">
<h3 id="fields-inherited-from-class-org.apache.accumulo.core.spi.scan.ScanServerSelector">Fields inherited from interface&nbsp;org.apache.accumulo.core.spi.scan.<a href="ScanServerSelector.html" title="interface in org.apache.accumulo.core.spi.scan">ScanServerSelector</a></h3>
<code><a href="ScanServerSelector.html#DEFAULT_SCAN_SERVER_GROUP_NAME">DEFAULT_SCAN_SERVER_GROUP_NAME</a></code></div>
</section>
</li>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<li>
<section class="constructor-summary" id="constructor-summary">
<h2>Constructor Summary</h2>
<div class="caption"><span>Constructors</span></div>
<div class="summary-table two-column-summary">
<div class="table-header col-first">Constructor</div>
<div class="table-header col-last">Description</div>
<div class="col-constructor-name even-row-color"><code><a href="#%3Cinit%3E()" class="member-name-link">ConfigurableScanServerSelector</a>()</code></div>
<div class="col-last even-row-color">&nbsp;</div>
</div>
</section>
</li>
<!-- ========== METHOD SUMMARY =========== -->
<li>
<section class="method-summary" id="method-summary">
<h2>Method Summary</h2>
<div id="method-summary-table">
<div class="table-tabs" role="tablist" aria-orientation="horizontal"><button id="method-summary-table-tab0" role="tab" aria-selected="true" aria-controls="method-summary-table.tabpanel" tabindex="0" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table', 3)" class="active-table-tab">All Methods</button><button id="method-summary-table-tab2" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab2', 3)" class="table-tab">Instance Methods</button><button id="method-summary-table-tab4" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab4', 3)" class="table-tab">Concrete Methods</button></div>
<div id="method-summary-table.tabpanel" role="tabpanel">
<div class="summary-table three-column-summary" aria-labelledby="method-summary-table-tab0">
<div class="table-header col-first">Modifier and Type</div>
<div class="table-header col-second">Method</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#init(org.apache.accumulo.core.spi.scan.ScanServerSelector.InitParameters)" class="member-name-link">init</a><wbr>(<a href="ScanServerSelector.InitParameters.html" title="interface in org.apache.accumulo.core.spi.scan">ScanServerSelector.InitParameters</a>&nbsp;params)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">This method is called once after a <a href="ScanServerSelector.html" title="interface in org.apache.accumulo.core.spi.scan"><code>ScanServerSelector</code></a> is instantiated.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="ScanServerSelections.html" title="interface in org.apache.accumulo.core.spi.scan">ScanServerSelections</a></code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#selectServers(org.apache.accumulo.core.spi.scan.ScanServerSelector.SelectorParameters)" class="member-name-link">selectServers</a><wbr>(<a href="ScanServerSelector.SelectorParameters.html" title="interface in org.apache.accumulo.core.spi.scan">ScanServerSelector.SelectorParameters</a>&nbsp;params)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Uses the <a href="ScanServerSelector.SelectorParameters.html" title="interface in org.apache.accumulo.core.spi.scan"><code>ScanServerSelector.SelectorParameters</code></a> to determine which, if any, ScanServer should be used for
 scanning a tablet.</div>
</div>
</div>
</div>
</div>
<div class="inherited-list">
<h3 id="methods-inherited-from-class-java.lang.Object">Methods inherited from class&nbsp;java.lang.<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a></h3>
<code><a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html#clone()" title="class or interface in java.lang" class="external-link">clone</a>, <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html#equals(java.lang.Object)" title="class or interface in java.lang" class="external-link">equals</a>, <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html#finalize()" title="class or interface in java.lang" class="external-link">finalize</a>, <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html#getClass()" title="class or interface in java.lang" class="external-link">getClass</a>, <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html#hashCode()" title="class or interface in java.lang" class="external-link">hashCode</a>, <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html#notify()" title="class or interface in java.lang" class="external-link">notify</a>, <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html#notifyAll()" title="class or interface in java.lang" class="external-link">notifyAll</a>, <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html#toString()" title="class or interface in java.lang" class="external-link">toString</a>, <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html#wait()" title="class or interface in java.lang" class="external-link">wait</a>, <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html#wait(long)" title="class or interface in java.lang" class="external-link">wait</a>, <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html#wait(long,int)" title="class or interface in java.lang" class="external-link">wait</a></code></div>
</section>
</li>
</ul>
</section>
<section class="details">
<ul class="details-list">
<!-- ============ FIELD DETAIL =========== -->
<li>
<section class="field-details" id="field-detail">
<h2>Field Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="PROFILES_DEFAULT">
<h3>PROFILES_DEFAULT</h3>
<div class="member-signature"><span class="modifiers">public static final</span>&nbsp;<span class="return-type"><a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a></span>&nbsp;<span class="element-name">PROFILES_DEFAULT</span></div>
<dl class="notes">
<dt>See Also:</dt>
<dd>
<ul class="see-list">
<li><a href="../../../../../../constant-values.html#org.apache.accumulo.core.spi.scan.ConfigurableScanServerSelector.PROFILES_DEFAULT">Constant Field Values</a></li>
</ul>
</dd>
</dl>
</section>
</li>
</ul>
</section>
</li>
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<li>
<section class="constructor-details" id="constructor-detail">
<h2>Constructor Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="&lt;init&gt;()">
<h3>ConfigurableScanServerSelector</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="element-name">ConfigurableScanServerSelector</span>()</div>
</section>
</li>
</ul>
</section>
</li>
<!-- ============ METHOD DETAIL ========== -->
<li>
<section class="method-details" id="method-detail">
<h2>Method Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="init(org.apache.accumulo.core.spi.scan.ScanServerSelector.InitParameters)">
<h3>init</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">init</span><wbr><span class="parameters">(<a href="ScanServerSelector.InitParameters.html" title="interface in org.apache.accumulo.core.spi.scan">ScanServerSelector.InitParameters</a>&nbsp;params)</span></div>
<div class="block"><span class="descfrm-type-label">Description copied from interface:&nbsp;<code><a href="ScanServerSelector.html#init(org.apache.accumulo.core.spi.scan.ScanServerSelector.InitParameters)">ScanServerSelector</a></code></span></div>
<div class="block">This method is called once after a <a href="ScanServerSelector.html" title="interface in org.apache.accumulo.core.spi.scan"><code>ScanServerSelector</code></a> is instantiated.</div>
<dl class="notes">
<dt>Specified by:</dt>
<dd><code><a href="ScanServerSelector.html#init(org.apache.accumulo.core.spi.scan.ScanServerSelector.InitParameters)">init</a></code>&nbsp;in interface&nbsp;<code><a href="ScanServerSelector.html" title="interface in org.apache.accumulo.core.spi.scan">ScanServerSelector</a></code></dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="selectServers(org.apache.accumulo.core.spi.scan.ScanServerSelector.SelectorParameters)">
<h3>selectServers</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type"><a href="ScanServerSelections.html" title="interface in org.apache.accumulo.core.spi.scan">ScanServerSelections</a></span>&nbsp;<span class="element-name">selectServers</span><wbr><span class="parameters">(<a href="ScanServerSelector.SelectorParameters.html" title="interface in org.apache.accumulo.core.spi.scan">ScanServerSelector.SelectorParameters</a>&nbsp;params)</span></div>
<div class="block"><span class="descfrm-type-label">Description copied from interface:&nbsp;<code><a href="ScanServerSelector.html#selectServers(org.apache.accumulo.core.spi.scan.ScanServerSelector.SelectorParameters)">ScanServerSelector</a></code></span></div>
<div class="block">Uses the <a href="ScanServerSelector.SelectorParameters.html" title="interface in org.apache.accumulo.core.spi.scan"><code>ScanServerSelector.SelectorParameters</code></a> to determine which, if any, ScanServer should be used for
 scanning a tablet.</div>
<dl class="notes">
<dt>Specified by:</dt>
<dd><code><a href="ScanServerSelector.html#selectServers(org.apache.accumulo.core.spi.scan.ScanServerSelector.SelectorParameters)">selectServers</a></code>&nbsp;in interface&nbsp;<code><a href="ScanServerSelector.html" title="interface in org.apache.accumulo.core.spi.scan">ScanServerSelector</a></code></dd>
<dt>Parameters:</dt>
<dd><code>params</code> - parameters for the calculation</dd>
<dt>Returns:</dt>
<dd>results</dd>
</dl>
</section>
</li>
</ul>
</section>
</li>
</ul>
</section>
<!-- ========= END OF CLASS DATA ========= -->
</main>
<footer role="contentinfo">
<hr>
<p class="legal-copy"><small>Copyright &#169; 2011&#x2013;2023 <a href="https://www.apache.org">The Apache Software Foundation</a>. All rights reserved.</small></p>
</footer>
</div>
</div>
</body>
</html>
