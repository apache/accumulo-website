<!DOCTYPE html>
<html lang="en">
<head>
<!--
    Licensed to the Apache Software Foundation (ASF) under one or more
    contributor license agreements.  See the NOTICE file distributed with
    this work for additional information regarding copyright ownership.
    The ASF licenses this file to You under the Apache License, Version 2.0
    (the "License"); you may not use this file except in compliance with
    the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
-->
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/paper/bootstrap.min.css" rel="stylesheet" integrity="sha384-awusxf8AUojygHf2+joICySzB780jVvQaVCAt1clU3QsyAitLGul28Qxb2r1e5g+" crossorigin="anonymous">
<link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/bs/jq-2.2.3/dt-1.10.12/datatables.min.css">
<link href="/css/accumulo.css" rel="stylesheet" type="text/css">

<title>Security Performance Implications</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script type="text/javascript" src="https://cdn.datatables.net/v/bs/jq-2.2.3/dt-1.10.12/datatables.min.js"></script>
<script>
  // show location of canonical site if not currently on the canonical site
  $(function() {
    var host = window.location.host;
    if (typeof host !== 'undefined' && host !== 'accumulo.apache.org') {
      $('#non-canonical').show();
    }
  });

  $(function() {
    // decorate section headers with anchors
    return $("h2, h3, h4, h5, h6").each(function(i, el) {
      var $el, icon, id;
      $el = $(el);
      id = $el.attr('id');
      icon = '<i class="fa fa-link"></i>';
      if (id) {
        return $el.append($("<a />").addClass("header-link").attr("href", "#" + id).html(icon));
      }
    });
  });

  // fix sidebar width in documentation
  $(function() {
    var $affixElement = $('div[data-spy="affix"]');
    $affixElement.width($affixElement.parent().width());
  });
</script>

</head>
<body style="padding-top: 100px">

  <nav class="navbar navbar-default navbar-fixed-top">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-items">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a href="/"><img id="nav-logo" alt="Apache Accumulo" class="img-responsive" src="/images/accumulo-logo.png" width="200"
        /></a>
    </div>
    <div class="collapse navbar-collapse" id="navbar-items">
      <ul class="nav navbar-nav">
        <li class="nav-link"><a href="/downloads">Download</a></li>
        <li class="nav-link"><a href="/tour">Tour</a></li>
        <li class="dropdown">
          <a class="dropdown-toggle" data-toggle="dropdown" href="#">Releases<span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="/release/accumulo-2.0.0/">2.0.0 (Latest)</a></li>
            <li><a href="/release/accumulo-1.9.3/">1.9.3</a></li>
            <li><a href="/release/">Archive</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a class="dropdown-toggle" data-toggle="dropdown" href="#">Documentation<span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="/docs/2.x">User Manual (2.x)</a></li>
            <li><a href="/docs/2.x/apidocs">Javadocs (2.0)</a></li>
            <li><a href="/quickstart-1.x">Quickstart (1.x)</a></li>
            <li><a href="/accumulo2-maven-plugin">Accumulo Maven Plugin</a></li>
            <li><a href="/1.9/accumulo_user_manual.html">User Manual (1.9)</a></li>
            <li><a href="/1.9/apidocs">Javadocs (1.9)</a></li>
            <li><a href="/external-docs">External Docs</a></li>
            <li><a href="/docs-archive/">Archive</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a class="dropdown-toggle" data-toggle="dropdown" href="#">Community<span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="/contact-us">Contact Us</a></li>
            <li><a href="/how-to-contribute">How To Contribute</a></li>
            <li><a href="/people">People</a></li>
            <li><a href="/related-projects">Related Projects</a></li>
          </ul>
        </li>
        <li class="nav-link"><a href="/search">Search</a></li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li class="dropdown">
          <a class="dropdown-toggle" data-toggle="dropdown" href="#"><img alt="Apache Software Foundation" src="https://www.apache.org/foundation/press/kit/feather.svg" width="15"/><span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="https://www.apache.org">Apache Homepage <i class="fa fa-external-link"></i></a></li>
            <li><a href="https://www.apache.org/licenses/">License <i class="fa fa-external-link"></i></a></li>
            <li><a href="https://www.apache.org/foundation/sponsorship">Sponsorship <i class="fa fa-external-link"></i></a></li>
            <li><a href="https://www.apache.org/security">Security <i class="fa fa-external-link"></i></a></li>
            <li><a href="https://www.apache.org/foundation/thanks">Thanks <i class="fa fa-external-link"></i></a></li>
            <li><a href="https://www.apache.org/foundation/policies/conduct">Code of Conduct <i class="fa fa-external-link"></i></a></li>
            <li><a href="https://www.apache.org/events/current-event.html">Current Event <i class="fa fa-external-link"></i></a></li>
          </ul>
        </li>
      </ul>
    </div>
  </div>
</nav>


  <div class="container">
    <div class="row">
      <div class="col-md-12">

        <div id="non-canonical" style="display: none; background-color: #F0E68C; padding-left: 1em;">
          Visit the official site at: <a href="https://accumulo.apache.org">https://accumulo.apache.org</a>
        </div>
        <div id="content">
          
          <h1 class="title">Security Performance Implications</h1>
          
          <p>

<b>Date: </b>&nbsp;&nbsp;06 Mar 2017<br>

</p>


<p>The purpose of this two part series was to measure the performance impact of
various security configurations on a cluster running Apache Accumulo’s
continuous ingest suite. The tests were performed using Amazon Web
Services (AWS), Hortonworks Data Platform 2.4 and Accumulo 1.7. Each of
the five different security settings in Accumulo 1.7 was tested including 
no security, SSL, and SASL with Kerberos authentication for the three quality 
of protection levels (auth, auth-int, auth-conf).  KDC was MIT.  HDFS was 
configured to use Kerberos for authentication and had service level 
authorization on. Other than that, no other security settings (HTTPS, RPC 
protection, data transfer encryption, etc) were enabled.  Timely was a 
separate, single node HDFS/Zookeeper/Accumulo instance.</p>

<h2 id="intro">Intro</h2>

<p>All runs utilized the continuous ingest suite that ships with Accumulo (a
standard method to measure performance in Accumulo).  It generates random 
graph data and inserts it into Accumulo, creating
a long linked list of entries.  Part 1 was run with just continuous ingest.<br />
Based on the test results, there was a measurable performance impact as each additional security configuration was put in place.</p>

<h2 id="methodology">Methodology</h2>

<p>We ran 5 tests, one for each security configuration.  Each iteration of each test inserted 2 billion entries.  Batch writers were configured with 500K max mem 
to artificially inflate the overall write overhead. This was performed on a
small cluster on AWS.</p>

<p>Each test used one of the following security configurations:</p>

<ul>
  <li>No security - Default</li>
  <li>Two way SSL</li>
  <li>Kerberos/SASL with auth
    <ul>
      <li>auth is just Kerberos authentication between client and server.  Each end of the RPC definitively knows who the other is.</li>
    </ul>
  </li>
  <li>Kerberos/SASL with auth-int
    <ul>
      <li>Builds on auth, also providing message integrity checks of the data going across the wire. You also know that the message you received was not altered.</li>
    </ul>
  </li>
  <li>Kerberos/SASL with auth-conf
    <ul>
      <li>Builds on auth-int, also providing confidentiality of the message that was sent to prevent others from reading it (aka wire-encryption).</li>
    </ul>
  </li>
</ul>

<p>For each test, five iterations were run to obtain a min, max, and median
time elapsed at each security configuration. After each iteration,
Hadoop, and Zookeeper processes were restarted, Accumulo tables are
wiped clean and tables are recreated. In addition, pagecache, dentries
and inodes are dropped by issuing a ‘3’ command on
/proc/sys/vm/drop_caches to ensure that the OS is not caching things to disk
that might affect the benchmark. The following sequence was performed 
between iterations:</p>

<ol>
  <li>Bring down Accumulo</li>
  <li>Bring down Zookeeper</li>
  <li>Bring down Hadoop</li>
  <li>Run sync command</li>
  <li>Drop OS cache</li>
  <li>Bring up Hadoop</li>
  <li>Bring up Zookeeper</li>
  <li>Bring up Accumulo</li>
  <li>Drop tables</li>
  <li>Create tables</li>
</ol>

<p>For each iteration, the results were stored, fed into <a href="https://nationalsecurityagency.github.io/timely/">Timely</a>, and viewed with Grafana.
Since the runs were executed sequentially, the start epochs for each run did not align.
To mitigate, the entries for each run were inserted 
with the same relative epoch for convenient comparison in Grafana.</p>

<p>The table configurations for Accumulo remain the same throughout the
different iterations and security levels. The Accumulo site
configurations differ only due to the different settings for the
security level configurations.</p>

<h2 id="environment">Environment</h2>

<p>In order to perform the testing, a small AWS cluster was setup using 14
hosts on EC2. Two i2.xlarge instances were used as master nodes and eight
d2.xlarge instances were used for workers. In addition, two c4.4xlarge
instances were used for ingesters, one m4.2xlarge instance was used for
Timely, and one m4.xlarge instance was used for Apache Ambari. A logical
diagram of the setup is depicted below:</p>

<p><img src="/images/blog/201702_security/figure1.png" alt="" width="400px" /></p>

<p>Figure 1 - Cluster Layout, Roles, and Instance Types on AWS.</p>

<p>The types of nodes and their function are given below:</p>

<table id="instance_types" class="table">
  <thead>
    <tr>
      <th style="text-align: left">Node Type</th>
      <th style="text-align: left">AWS EC2 Type</th>
      <th style="text-align: left">EC2 Type Details</th>
      <th style="text-align: left">Quantity</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">Ingest Nodes</td>
      <td style="text-align: left">c4.4xlarge</td>
      <td style="text-align: left">16 core, 30 GB RAM</td>
      <td style="text-align: left">2</td>
    </tr>
    <tr>
      <td style="text-align: left">Worker Node</td>
      <td style="text-align: left">d2.xlarge</td>
      <td style="text-align: left">4 cores, 30.5 GB RAM, 3x2T GB HD</td>
      <td style="text-align: left">8</td>
    </tr>
    <tr>
      <td style="text-align: left">Master Node</td>
      <td style="text-align: left">i2.xlarge</td>
      <td style="text-align: left">4 cores, 30.5 GB RAM, 1x800GB SSD</td>
      <td style="text-align: left">2</td>
    </tr>
    <tr>
      <td style="text-align: left">Admin Node</td>
      <td style="text-align: left">m4.xlarge</td>
      <td style="text-align: left">4 cores, 16 GB RAM</td>
      <td style="text-align: left">1</td>
    </tr>
    <tr>
      <td style="text-align: left">Timely Node</td>
      <td style="text-align: left">m4.2xlarge</td>
      <td style="text-align: left">8 cores, 32 GB RAM</td>
      <td style="text-align: left">1</td>
    </tr>
  </tbody>
</table>

<p>Table 1 – AWS Instance Types, Role, Details, and Quantities</p>

<h2 id="results">Results</h2>

<p>The median, max, and min of the milliseconds elapsed
time of all iterations for each test is displayed below. The percentage change
columns compare the Median, Max, and Min respectively from the no
security level to each security configuration (e.g. no security Median
vs. auth-int Median, no security Max vs. auth-int Max).</p>

<table id="results" class="table">
  <thead>
    <tr>
      <th>Security Level</th>
      <th style="text-align: right">Median</th>
      <th style="text-align: right">Standard Deviation</th>
      <th style="text-align: right">Max</th>
      <th style="text-align: right">Min</th>
      <th style="text-align: right">% Change (nosec Median vs. Median)</th>
      <th style="text-align: right">% Change (nosec Max vs. Max)</th>
      <th style="text-align: right">% Change (nosec Min vs. Min)</th>
      <th style="text-align: right">Delta from Previous Level (Median)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>no security</td>
      <td style="text-align: right">7829394</td>
      <td style="text-align: right">139340</td>
      <td style="text-align: right">8143035</td>
      <td style="text-align: right">7764309</td>
      <td style="text-align: right">0.00%</td>
      <td style="text-align: right">0.00%</td>
      <td style="text-align: right">0.00%</td>
      <td style="text-align: right">0.00%</td>
    </tr>
    <tr>
      <td>ssl</td>
      <td style="text-align: right">8292760</td>
      <td style="text-align: right">87012</td>
      <td style="text-align: right">8464060</td>
      <td style="text-align: right">8204955</td>
      <td style="text-align: right">5.92%</td>
      <td style="text-align: right">3.94%</td>
      <td style="text-align: right">5.68%</td>
      <td style="text-align: right">5.92%</td>
    </tr>
    <tr>
      <td>auth</td>
      <td style="text-align: right">8859552</td>
      <td style="text-align: right">134109</td>
      <td style="text-align: right">9047971</td>
      <td style="text-align: right">8657618</td>
      <td style="text-align: right">13.16%</td>
      <td style="text-align: right">11.11%</td>
      <td style="text-align: right">11.51%</td>
      <td style="text-align: right">6.83%</td>
    </tr>
    <tr>
      <td>auth-int</td>
      <td style="text-align: right">9500737</td>
      <td style="text-align: right">155968</td>
      <td style="text-align: right">9753424</td>
      <td style="text-align: right">9282371</td>
      <td style="text-align: right">21.34%</td>
      <td style="text-align: right">19.78%</td>
      <td style="text-align: right">19.55%</td>
      <td style="text-align: right">7.24%</td>
    </tr>
    <tr>
      <td>auth-conf</td>
      <td style="text-align: right">9479635</td>
      <td style="text-align: right">170823</td>
      <td style="text-align: right">9776580</td>
      <td style="text-align: right">9282189</td>
      <td style="text-align: right">21.08%</td>
      <td style="text-align: right">20.06%</td>
      <td style="text-align: right">19.55%</td>
      <td style="text-align: right">-0.22%</td>
    </tr>
  </tbody>
</table>

<p>Table 2 – Summarized Time Elapsed for Each Security Level</p>

<h2 id="plots">Plots</h2>

<p>Below are some snapshots of *stats.out elements via Grafana that were inserted
into Timely with the same relative start time.  Each graph represents a field 
in the output generated by <a href="https://github.com/apache/accumulo/blob/1.7/test/src/main/java/org/apache/accumulo/test/continuous/ContinuousStatsCollector.java">ContinuousStatsCollector</a></p>

<h3 id="table_recs"><a href="https://github.com/apache/accumulo/blob/1.7/core/src/main/java/org/apache/accumulo/core/master/thrift/TableInfo.java#L73">TABLE_RECS</a></h3>
<p>(Number of records in the continuous ingest table.  Down sample=1m, aggregate=avg)</p>

<p><a href="/images/blog/201702_security/tableRecs.png"><img src="/images/blog/201702_security/tableRecs.png" alt="" width="800px" /></a></p>

<h3 id="total_ingest"><a href="https://github.com/apache/accumulo/blob/1.7/core/src/main/java/org/apache/accumulo/core/master/thrift/TableInfo.java#L77">TOTAL_INGEST</a></h3>
<p>(Ingest rate for Accumulo instance.  Down sample=5m, aggregate=avg)</p>

<p><a href="/images/blog/201702_security/totalIngest.png"><img src="/images/blog/201702_security/totalIngest.png" alt="" width="800px" /></a></p>

<h3 id="avg_filestablet"><a href="https://github.com/apache/accumulo/blob/1.7/core/src/main/java/org/apache/accumulo/core/util/Stat.java#L63">AVG_FILES/TABLET</a></h3>
<p>(Average number of files per Accumulo tablet.  Down sample=1m, aggregate=avg)</p>

<p><a href="/images/blog/201702_security/avgFilesTab.png"><img src="/images/blog/201702_security/avgFilesTab.png" alt="" width="800px" /></a></p>

<h3 id="accumulo_files"><a href="https://github.com/apache/accumulo/blob/1.7/test/src/main/java/org/apache/accumulo/test/continuous/ContinuousStatsCollector.java#L127">ACCUMULO_FILES</a></h3>
<p>(Total number of files for Accumulo.  Down sample=1m, aggregate=avg)</p>

<p><a href="/images/blog/201702_security/accumuloFiles.png"><img src="/images/blog/201702_security/accumuloFiles.png" alt="" width="800px" /></a></p>

<p>As can be seen in the plots above, the different security settings have 
relatively consistent, discernible median run characteristics.  The big
dip in each TOTAL_INGEST coincides with a large number of major
compactions, a rate decrease for TABLE_RECS, and a decrease in 
AVG_FILES/TABLET.</p>

<h2 id="final-thoughts">Final Thoughts</h2>

<p>The biggest performance 
hits to run duration median (compared to default security) were ~21% for 
auth-int and auth-conf.  Interesting to note that SSL’s median run duration was 
lower than all SASL configs and that auth-conf’s was lower than auth-int. 
Initial  speculation for these oddities revolved around the 
<a href="https://github.com/m1ch1/mapkeeper/wiki/Thrift-Java-Servers-Compared">Thrift server</a> 
implementations, but the Thrift differences will not explain the auth-conf/int 
disparity since both utilize TThreadPoolServer.  It was certainly unexpected that the 
addition of wire encryption would yield a faster median run duration.  This result 
prompted, as a sanity check, sniffing the net traffic (in a contrived example 
not during a timed run) in both auth-conf and auth-int to ensure that the message 
contents were actually obfuscated in auth-conf (they were) and not obfuscated in 
auth-int (they weren’t).</p>

<h2 id="future-work">Future Work</h2>

<p>Part 2 of this series will consist of the same continuous ingest loads and 
configurations with the addition of a query load on the system.</p>



<p><strong>View all posts in the <a href="/news">news archive</a></strong></p>

        </div>

        
<footer>

  <p><a href="https://www.apache.org/foundation/contributing"><img src="https://www.apache.org/images/SupportApache-small.png" alt="Support the ASF" id="asf-logo" height="100" /></a></p>

  <p>Copyright © 2011-2020 <a href="https://www.apache.org">The Apache Software Foundation</a>.
Licensed under the <a href="https://www.apache.org/licenses/">Apache License, Version 2.0</a>.</p>

  <p>Apache®, the names of Apache projects and their logos, and the multicolor feather
logo are registered trademarks or trademarks of The Apache Software Foundation
in the United States and/or other countries.</p>

</footer>


      </div>
    </div>
  </div>
</body>
</html>
