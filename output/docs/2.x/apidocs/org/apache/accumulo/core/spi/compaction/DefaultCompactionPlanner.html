<!DOCTYPE HTML>
<html lang="en">
<head>
<!-- Generated by javadoc (17) -->
<title>DefaultCompactionPlanner (Apache Accumulo Project 2.1.3 API)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="description" content="declaration: package: org.apache.accumulo.core.spi.compaction, class: DefaultCompactionPlanner">
<meta name="generator" content="javadoc/ClassWriterImpl">
<link rel="stylesheet" type="text/css" href="../../../../../../stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../../../script-dir/jquery-ui.min.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../../../jquery-ui.overrides.css" title="Style">
<script type="text/javascript" src="../../../../../../script.js"></script>
<script type="text/javascript" src="../../../../../../script-dir/jquery-3.6.1.min.js"></script>
<script type="text/javascript" src="../../../../../../script-dir/jquery-ui.min.js"></script>
</head>
<body class="class-declaration-page">
<script type="text/javascript">var evenRowColor = "even-row-color";
var oddRowColor = "odd-row-color";
var tableTab = "table-tab";
var activeTableTab = "active-table-tab";
var pathtoroot = "../../../../../../";
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<div class="flex-box">
<header role="banner" class="flex-header">
<nav role="navigation">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="top-nav" id="navbar-top">
<div class="skip-nav"><a href="#skip-navbar-top" title="Skip navigation links">Skip navigation links</a></div>
<ul id="navbar-top-firstrow" class="nav-list" title="Navigation">
<li><a href="../../../../../../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="nav-bar-cell1-rev">Class</li>
<li><a href="class-use/DefaultCompactionPlanner.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../../help-doc.html#class">Help</a></li>
</ul>
</div>
<div class="sub-nav">
<div>
<ul class="sub-nav-list">
<li>Summary:&nbsp;</li>
<li><a href="#nested-class-summary">Nested</a>&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor-summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method-summary">Method</a></li>
</ul>
<ul class="sub-nav-list">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor-detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method-detail">Method</a></li>
</ul>
</div>
<div class="nav-list-search"><label for="search-input">SEARCH:</label>
<input type="text" id="search-input" value="search" disabled="disabled">
<input type="reset" id="reset-button" value="reset" disabled="disabled">
</div>
</div>
<!-- ========= END OF TOP NAVBAR ========= -->
<span class="skip-nav" id="skip-navbar-top"></span></nav>
</header>
<div class="flex-content">
<main role="main">
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="sub-title"><span class="package-label-in-type">Package</span>&nbsp;<a href="package-summary.html">org.apache.accumulo.core.spi.compaction</a></div>
<h1 title="Class DefaultCompactionPlanner" class="title">Class DefaultCompactionPlanner</h1>
</div>
<div class="inheritance" title="Inheritance Tree"><a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">java.lang.Object</a>
<div class="inheritance">org.apache.accumulo.core.spi.compaction.DefaultCompactionPlanner</div>
</div>
<section class="class-description" id="class-description">
<dl class="notes">
<dt>All Implemented Interfaces:</dt>
<dd><code><a href="CompactionPlanner.html" title="interface in org.apache.accumulo.core.spi.compaction">CompactionPlanner</a></code></dd>
</dl>
<hr>
<div class="type-signature"><span class="modifiers">public class </span><span class="element-name type-name-label">DefaultCompactionPlanner</span>
<span class="extends-implements">extends <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a>
implements <a href="CompactionPlanner.html" title="interface in org.apache.accumulo.core.spi.compaction">CompactionPlanner</a></span></div>
<div class="block">Finds the largest continuous set of small files that meet the compaction ratio and do not prevent
 future compactions.

 <p>
 The following configuration options are supported. Replace <code>&lt;service&gt;</code> with the name of the
 compaction service you are configuring.

 <ul>
 <li><code>tserver.compaction.major.service.&lt;service&gt;.opts.executors</code> This is a json array of
 objects where each object has the fields:
 <table>
 <caption>Default Compaction Planner Executor options</caption>
 <tr>
 <th>Field Name</th>
 <th>Description</th>
 </tr>
 <tr>
 <td>name</td>
 <td>name or alias of the executor (required)</td>
 </tr>
 <tr>
 <td>type</td>
 <td>valid values 'internal' or 'external' (required)</td>
 </tr>
 <tr>
 <td>maxSize</td>
 <td>threshold sum of the input files (required for all but one of the configs)</td>
 </tr>
 <tr>
 <td>numThreads</td>
 <td>number of threads for this executor configuration (required for 'internal', cannot be
 specified for 'external')</td>
 </tr>
 <tr>
 <td>queue</td>
 <td>name of the external compaction queue (required for 'external', cannot be specified for
 'internal')</td>
 </tr>
 </table>
 <br>
 The maxSize field determines the maximum size of compaction that will run on an executor. The
 maxSize field can have a suffix of K,M,G for kilobytes, megabytes, or gigabytes and represents
 the sum of the input files for a given compaction. One executor can have no max size and it will
 run everything that is too large for the other executors. If all executors have a max size, then
 system compactions will only run for compactions smaller than the largest max size. User, chop,
 and selector compactions will always run, even if there is no executor for their size. These
 compactions will run on the executor with the largest max size. The following example value for
 this property will create 3 threads to run compactions of files whose file size sum is less than
 100M, 3 threads to run compactions of files whose file size sum is less than 500M, and run all
 other compactions on Compactors configured to run compactions for Queue1:

 <pre>
 <code>
 [
  {"name":"small", "type": "internal", "maxSize":"100M","numThreads":3},
  {"name":"medium", "type": "internal", "maxSize":"500M","numThreads":3},
  {"name":"large", "type":"external", "queue":"Queue1"}
 ]</code>
 </pre>

 Note that the use of 'external' requires that the CompactionCoordinator and at least one
 Compactor for Queue1 is running.
 <li><code>tserver.compaction.major.service.&lt;service&gt;.opts.maxOpen</code> This determines the maximum
 number of files that will be included in a single compaction.
 </ul>

 <p>
 Starting with Accumulo 2.1.3, this plugin will use the table config option
 <code>"table.file.max"</code>. When the following four conditions are met, then this plugin will try
 to find a lower compaction ratio that will result in a compaction:
 <ol>
 <li>When a tablet has no compactions running</li>
 <li>Its number of files exceeds table.file.max</li>
 <li>System compactions are not finding anything to compact</li>
 <li>No files are selected for user compaction</li>
 </ol>
 For example, given a tablet with 20 files, and table.file.max is 15 and no compactions are
 planned. If the compaction ratio is set to 3, then this plugin will find the largest compaction
 ratio less than 3 that results in a compaction.</div>
<dl class="notes">
<dt>Since:</dt>
<dd>2.1.0</dd>
<dt>See Also:</dt>
<dd>
<ul class="see-list-long">
<li><a href="package-summary.html"><code>org.apache.accumulo.core.spi.compaction</code></a></li>
</ul>
</dd>
</dl>
</section>
<section class="summary">
<ul class="summary-list">
<!-- ======== NESTED CLASS SUMMARY ======== -->
<li>
<section class="nested-class-summary" id="nested-class-summary">
<h2>Nested Class Summary</h2>
<div class="inherited-list">
<h2 id="nested-classes-inherited-from-class-org.apache.accumulo.core.spi.compaction.CompactionPlanner">Nested classes/interfaces inherited from interface&nbsp;org.apache.accumulo.core.spi.compaction.<a href="CompactionPlanner.html" title="interface in org.apache.accumulo.core.spi.compaction">CompactionPlanner</a></h2>
<code><a href="CompactionPlanner.InitParameters.html" title="interface in org.apache.accumulo.core.spi.compaction">CompactionPlanner.InitParameters</a>, <a href="CompactionPlanner.PlanningParameters.html" title="interface in org.apache.accumulo.core.spi.compaction">CompactionPlanner.PlanningParameters</a></code></div>
</section>
</li>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<li>
<section class="constructor-summary" id="constructor-summary">
<h2>Constructor Summary</h2>
<div class="caption"><span>Constructors</span></div>
<div class="summary-table two-column-summary">
<div class="table-header col-first">Constructor</div>
<div class="table-header col-last">Description</div>
<div class="col-constructor-name even-row-color"><code><a href="#%3Cinit%3E()" class="member-name-link">DefaultCompactionPlanner</a>()</code></div>
<div class="col-last even-row-color">&nbsp;</div>
</div>
</section>
</li>
<!-- ========== METHOD SUMMARY =========== -->
<li>
<section class="method-summary" id="method-summary">
<h2>Method Summary</h2>
<div id="method-summary-table">
<div class="table-tabs" role="tablist" aria-orientation="horizontal"><button id="method-summary-table-tab0" role="tab" aria-selected="true" aria-controls="method-summary-table.tabpanel" tabindex="0" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table', 3)" class="active-table-tab">All Methods</button><button id="method-summary-table-tab2" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab2', 3)" class="table-tab">Instance Methods</button><button id="method-summary-table-tab4" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab4', 3)" class="table-tab">Concrete Methods</button></div>
<div id="method-summary-table.tabpanel" role="tabpanel" aria-labelledby="method-summary-table-tab0">
<div class="summary-table three-column-summary">
<div class="table-header col-first">Modifier and Type</div>
<div class="table-header col-second">Method</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#init(org.apache.accumulo.core.spi.compaction.CompactionPlanner.InitParameters)" class="member-name-link">init</a><wbr>(<a href="CompactionPlanner.InitParameters.html" title="interface in org.apache.accumulo.core.spi.compaction">CompactionPlanner.InitParameters</a>&nbsp;params)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">&nbsp;</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="CompactionPlan.html" title="interface in org.apache.accumulo.core.spi.compaction">CompactionPlan</a></code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#makePlan(org.apache.accumulo.core.spi.compaction.CompactionPlanner.PlanningParameters)" class="member-name-link">makePlan</a><wbr>(<a href="CompactionPlanner.PlanningParameters.html" title="interface in org.apache.accumulo.core.spi.compaction">CompactionPlanner.PlanningParameters</a>&nbsp;params)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">
 Plan what work a compaction service should do.</div>
</div>
</div>
</div>
</div>
<div class="inherited-list">
<h3 id="methods-inherited-from-class-java.lang.Object">Methods inherited from class&nbsp;java.lang.<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a></h3>
<code><a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html#clone()" title="class or interface in java.lang" class="external-link">clone</a>, <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html#equals(java.lang.Object)" title="class or interface in java.lang" class="external-link">equals</a>, <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html#finalize()" title="class or interface in java.lang" class="external-link">finalize</a>, <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html#getClass()" title="class or interface in java.lang" class="external-link">getClass</a>, <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html#hashCode()" title="class or interface in java.lang" class="external-link">hashCode</a>, <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html#notify()" title="class or interface in java.lang" class="external-link">notify</a>, <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html#notifyAll()" title="class or interface in java.lang" class="external-link">notifyAll</a>, <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html#toString()" title="class or interface in java.lang" class="external-link">toString</a>, <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html#wait()" title="class or interface in java.lang" class="external-link">wait</a>, <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html#wait(long)" title="class or interface in java.lang" class="external-link">wait</a>, <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html#wait(long,int)" title="class or interface in java.lang" class="external-link">wait</a></code></div>
</section>
</li>
</ul>
</section>
<section class="details">
<ul class="details-list">
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<li>
<section class="constructor-details" id="constructor-detail">
<h2>Constructor Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="&lt;init&gt;()">
<h3>DefaultCompactionPlanner</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="element-name">DefaultCompactionPlanner</span>()</div>
</section>
</li>
</ul>
</section>
</li>
<!-- ============ METHOD DETAIL ========== -->
<li>
<section class="method-details" id="method-detail">
<h2>Method Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="init(org.apache.accumulo.core.spi.compaction.CompactionPlanner.InitParameters)">
<h3>init</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">init</span><wbr><span class="parameters">(<a href="CompactionPlanner.InitParameters.html" title="interface in org.apache.accumulo.core.spi.compaction">CompactionPlanner.InitParameters</a>&nbsp;params)</span></div>
<dl class="notes">
<dt>Specified by:</dt>
<dd><code><a href="CompactionPlanner.html#init(org.apache.accumulo.core.spi.compaction.CompactionPlanner.InitParameters)">init</a></code>&nbsp;in interface&nbsp;<code><a href="CompactionPlanner.html" title="interface in org.apache.accumulo.core.spi.compaction">CompactionPlanner</a></code></dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="makePlan(org.apache.accumulo.core.spi.compaction.CompactionPlanner.PlanningParameters)">
<h3>makePlan</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type"><a href="CompactionPlan.html" title="interface in org.apache.accumulo.core.spi.compaction">CompactionPlan</a></span>&nbsp;<span class="element-name">makePlan</span><wbr><span class="parameters">(<a href="CompactionPlanner.PlanningParameters.html" title="interface in org.apache.accumulo.core.spi.compaction">CompactionPlanner.PlanningParameters</a>&nbsp;params)</span></div>
<div class="block"><span class="descfrm-type-label">Description copied from interface:&nbsp;<code><a href="CompactionPlanner.html#makePlan(org.apache.accumulo.core.spi.compaction.CompactionPlanner.PlanningParameters)">CompactionPlanner</a></code></span></div>
<div class="block"><p>
 Plan what work a compaction service should do. The kind of compaction returned by
 <a href="CompactionPlanner.PlanningParameters.html#getKind()"><code>CompactionPlanner.PlanningParameters.getKind()</code></a> determines what must be done with the files returned by
 <a href="CompactionPlanner.PlanningParameters.html#getCandidates()"><code>CompactionPlanner.PlanningParameters.getCandidates()</code></a>. The following are the expectations for the
 candidates for each kind.

 <ul>
 <li>CompactionKind.SYSTEM The planner is not required to do anything with the candidates and
 can choose to compact zero or more of them. The candidates may represent a subset of all the
 files in the case where a user compaction is in progress or other compactions are running.
 <li>CompactionKind.USER and CompactionKind.SELECTED. The planner is required to eventually
 compact all candidates. Its ok to return a compaction plan that compacts a subset. When the
 planner compacts a subset, it will eventually be called again later. When it is called later
 the candidates will contain the files it did not compact and the results of any previous
 compactions it scheduled. The planner must eventually compact all of the files in the candidate
 set down to a single file. The compaction service will keep calling the planner until it does.
 <li>CompactionKind.CHOP. The planner is required to eventually compact all candidates. One
 major difference with USER compactions is this kind is not required to compact all files to a
 single file. It is ok to return a compaction plan that compacts a subset of the candidates.
 When the planner compacts a subset, it will eventually be called later. When it is called later
 the candidates will contain the files it did not compact.
 </ul>

 <p>
 For a chop compaction assume the following happens.
 <ol>
 <li>The candidate set passed to makePlan contains the files <code>[F1,F2,F3,F4]</code> and kind is
 CHOP
 <li>The planner returns a job to compact files <code>[F1,F2]</code> on executor E1
 <li>The compaction runs compacting <code>[F1,F2]</code> into file <code>[F5]</code>
 </ol>

 <p>
 For the case above, eventually the planner will called again with a candidate set of
 <code>[F3,F4]</code> and it must eventually compact those two files.

 <p>
 For a user and selector compaction assume the same thing happens, it will result in a slightly
 different outcome.
 <ol>
 <li>The candidate set passed to makePlan contains the files <code>[F1,F2,F3,F4]</code> and kind is
 USER
 <li>The planner returns a job to compact files <code>[F1,F2]</code> on executor E1
 <li>The compaction runs compacting <code>[F1,F2]</code> into file <code>[F5]</code>
 </ol>

 <p>
 For the case above, eventually the planner will called again with a candidate set of
 <code>[F3,F4,F5]</code> and it must eventually compact those three files to one. The difference with
 CHOP compactions is that the result of intermediate compactions are included in the candidate
 set.

 <p>
 When a planner returns a compactions plan, task will be queued on executors. Previously queued
 task that do not match the latest plan are removed. The planner is called periodically,
 whenever a new file is added, and whenever a compaction finishes.

 <p>
 Use <a href="CompactionPlanner.PlanningParameters.html#createPlanBuilder()"><code>CompactionPlanner.PlanningParameters.createPlanBuilder()</code></a> to build the plan this function returns.</div>
<dl class="notes">
<dt>Specified by:</dt>
<dd><code><a href="CompactionPlanner.html#makePlan(org.apache.accumulo.core.spi.compaction.CompactionPlanner.PlanningParameters)">makePlan</a></code>&nbsp;in interface&nbsp;<code><a href="CompactionPlanner.html" title="interface in org.apache.accumulo.core.spi.compaction">CompactionPlanner</a></code></dd>
<dt>See Also:</dt>
<dd>
<ul class="see-list">
<li><a href="CompactionKind.html" title="enum in org.apache.accumulo.core.spi.compaction"><code>CompactionKind</code></a></li>
</ul>
</dd>
</dl>
</section>
</li>
</ul>
</section>
</li>
</ul>
</section>
<!-- ========= END OF CLASS DATA ========= -->
</main>
<footer role="contentinfo">
<hr>
<p class="legal-copy"><small>Copyright &#169; 2011&#x2013;2024 <a href="https://www.apache.org">The Apache Software Foundation</a>. All rights reserved.</small></p>
</footer>
</div>
</div>
</body>
</html>
