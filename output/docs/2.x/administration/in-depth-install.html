<!DOCTYPE html>
<html lang="en">
<head>
<!--
    Licensed to the Apache Software Foundation (ASF) under one or more
    contributor license agreements.  See the NOTICE file distributed with
    this work for additional information regarding copyright ownership.
    The ASF licenses this file to You under the Apache License, Version 2.0
    (the "License"); you may not use this file except in compliance with
    the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
-->
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/bs5/dt-1.13.6/datatables.min.css">
<link href="/css/accumulo.css" rel="stylesheet" type="text/css">

<title>Accumulo Documentation - In-depth Installation</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js" integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script>
<script type="text/javascript" src="https://cdn.datatables.net/v/bs5/dt-1.13.6/datatables.min.js"></script>
<script type="text/javascript" src="https://www.apachecon.com/event-images/snippet.js"></script>
<script>
  // show location of canonical site if not currently on the canonical site
  $(function() {
    var host = window.location.host;
    if (typeof host !== 'undefined' && host !== 'accumulo.apache.org') {
      $('#non-canonical').show();
    }
  });

  $(function() {
    // decorate section headers with anchors
    return $("h2, h3, h4, h5, h6").not(".accordion-header").each(function(i, el) {
      var $el, icon, id;
      $el = $(el);
      id = $el.attr('id');
      icon = '<span class="fa-solid fa-link"></span>';
      if (id) {
        return $el.append($("<a />").addClass("header-link").attr("href", "#" + id).html(icon));
      }
    });
  });

  // fix sidebar width in documentation
  $(function() {
    var $affixElement = $('div[data-spy="affix"]');
    $affixElement.width($affixElement.parent().width());
  });
</script>

</head>
<body style="padding-top: 100px">

  <nav class="navbar navbar-expand-lg navbar-light fixed-top bg-light">
  <div class="container">
    <a class="navbar-brand" href="/">
      <img alt="Apache Accumulo" id="nav-logo" src="/images/accumulo-logo.png" width="200">
    </a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar-items">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbar-items">
      <ul class="navbar-nav me-auto">
        <li class="nav-item"><a class="nav-link" href="/downloads">Download</a></li>
        <li class="nav-item"><a class="nav-link" href="/tour">Tour</a></li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">Releases</a>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="/release/accumulo-3.0.0/">3.0.0 (Latest non-LTM)</a></li>
            <li><a class="dropdown-item" href="/release/accumulo-2.1.2/">2.1.2 (Latest LTM)</a></li>
            <li><a class="dropdown-item" href="/release/accumulo-1.10.4/">1.10.4 (Legacy LTM)</a></li>
            <li><a class="dropdown-item" href="/release/">Archive</a></li>
          </ul>
        </li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">Documentation</a>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="/docs/2.x">User Manual (2.x)</a></li>
            <li><a class="dropdown-item" href="/docs/2.x/apidocs">Javadocs (2.x)</a></li>
            <li><a class="dropdown-item" href="/api">Public API</a></li>
            <li><a class="dropdown-item" href="/quickstart-1.x">Quickstart (1.x)</a></li>
            <li><a class="dropdown-item" href="/accumulo2-maven-plugin">Accumulo Maven Plugin</a></li>
            <li><a class="dropdown-item" href="/1.10/accumulo_user_manual.html">User Manual (1.10)</a></li>
            <li><a class="dropdown-item" href="/1.10/apidocs">Javadocs (1.10)</a></li>
            <li><a class="dropdown-item" href="/external-docs">External Docs</a></li>
            <li><a class="dropdown-item" href="/docs-archive/">Archive</a></li>
          </ul>
        </li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">Community</a>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="/contact-us">Contact Us</a></li>
            <li><a class="dropdown-item" href="/how-to-contribute">How To Contribute</a></li>
            <li><a class="dropdown-item" href="/people">People</a></li>
            <li><a class="dropdown-item" href="/related-projects">Related Projects</a></li>
          </ul>
        </li>
        <li class="nav-item"><a class="nav-link" href="/search">Search</a></li>
      </ul>
      <ul class="navbar-nav ms-auto">
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
            <img alt="Apache Software Foundation" src="https://www.apache.org/foundation/press/kit/feather.svg" width="15"/>
          </a>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="https://www.apache.org">Apache Homepage <span class="fa-solid fa-up-right-from-square"></span></a></li>
            <li><a class="dropdown-item" href="https://www.apache.org/licenses/">License <span class="fa-solid fa-up-right-from-square"></span></a></li>
            <li><a class="dropdown-item" href="https://www.apache.org/foundation/sponsorship">Sponsorship <span class="fa-solid fa-up-right-from-square"></span></a></li>
            <li><a class="dropdown-item" href="https://www.apache.org/security">Security <span class="fa-solid fa-up-right-from-square"></span></a></li>
            <li><a class="dropdown-item" href="https://www.apache.org/foundation/thanks">Thanks <span class="fa-solid fa-up-right-from-square"></span></a></li>
            <li><a class="dropdown-item" href="https://www.apache.org/foundation/policies/conduct">Code of Conduct <span class="fa-solid fa-up-right-from-square"></span></a></li>
            <li><a class="dropdown-item" href="https://www.apache.org/events/current-event.html">Current Event <span class="fa-solid fa-up-right-from-square"></span></a></li>
          </ul>
        </li>
      </ul>
    </div>
  </div>
</nav>


  <div class="container">
    <div class="row">
      <div class="col-md-12">

        <div id="non-canonical" style="display: none; background-color: #F0E68C; padding-left: 1em;">
          Visit the official site at: <a href="https://accumulo.apache.org">https://accumulo.apache.org</a>
        </div>
        <div id="content">
          
          <div class="row">
  <div class="col-md-3">
    <div class="accordion sticky-top" id="myAccordion" style="top: 100px;">
      
      
      
        
          
        
          
        
          
        
          
            <div class="accordion-item">
              <div class="accordion-header fs-5 fw-bold" id="headinggetting-started">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapsegetting-started" aria-expanded="false" aria-controls="collapsegetting-started">
                  Getting started
                </button>
              </div>
              <div id="collapsegetting-started" class="accordion-collapse collapse" aria-labelledby="headinggetting-started" data-bs-parent="#myAccordion">
                <div class="accordion-body">
                  
                  
                    <div class="row"><a href="/docs/2.x/getting-started/quickstart">Setup</a></div>
                  
                    <div class="row"><a href="/docs/2.x/getting-started/design">Design</a></div>
                  
                    <div class="row"><a href="/docs/2.x/getting-started/features">Features</a></div>
                  
                    <div class="row"><a href="/docs/2.x/getting-started/clients">Accumulo Clients</a></div>
                  
                    <div class="row"><a href="/docs/2.x/getting-started/shell">Accumulo Shell</a></div>
                  
                    <div class="row"><a href="/docs/2.x/getting-started/table_design">Table Design</a></div>
                  
                    <div class="row"><a href="/docs/2.x/getting-started/table_configuration">Table Configuration</a></div>
                  
                    <div class="row"><a href="/docs/2.x/getting-started/glossary">Glossary</a></div>
                  
                </div>
              </div>
            </div>
          
        
          
        
          
        
          
        
      
        
          
        
          
        
          
            <div class="accordion-item">
              <div class="accordion-header fs-5 fw-bold" id="headingdevelopment">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapsedevelopment" aria-expanded="false" aria-controls="collapsedevelopment">
                  Development
                </button>
              </div>
              <div id="collapsedevelopment" class="accordion-collapse collapse" aria-labelledby="headingdevelopment" data-bs-parent="#myAccordion">
                <div class="accordion-body">
                  
                  
                    <div class="row"><a href="/docs/2.x/development/iterators">Iterators</a></div>
                  
                    <div class="row"><a href="/docs/2.x/development/mapreduce">MapReduce</a></div>
                  
                    <div class="row"><a href="/docs/2.x/development/spark">Spark</a></div>
                  
                    <div class="row"><a href="/docs/2.x/development/development_tools">Development Tools</a></div>
                  
                    <div class="row"><a href="/docs/2.x/development/sampling">Sampling</a></div>
                  
                    <div class="row"><a href="/docs/2.x/development/summaries">Summary Statistics</a></div>
                  
                    <div class="row"><a href="/docs/2.x/development/proxy">Proxy</a></div>
                  
                    <div class="row"><a href="/docs/2.x/development/high_speed_ingest">High-Speed Ingest</a></div>
                  
                </div>
              </div>
            </div>
          
        
          
        
          
        
          
        
          
        
      
        
          
        
          
        
          
        
          
        
          
        
          
            <div class="accordion-item">
              <div class="accordion-header fs-5 fw-bold" id="headingsecurity">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapsesecurity" aria-expanded="false" aria-controls="collapsesecurity">
                  Security
                </button>
              </div>
              <div id="collapsesecurity" class="accordion-collapse collapse" aria-labelledby="headingsecurity" data-bs-parent="#myAccordion">
                <div class="accordion-body">
                  
                  
                    <div class="row"><a href="/docs/2.x/security/overview">Security Overview</a></div>
                  
                    <div class="row"><a href="/docs/2.x/security/authentication">Authentication</a></div>
                  
                    <div class="row"><a href="/docs/2.x/security/permissions">Permissions</a></div>
                  
                    <div class="row"><a href="/docs/2.x/security/authorizations">Authorizations</a></div>
                  
                    <div class="row"><a href="/docs/2.x/security/on-disk-encryption">On Disk Encryption</a></div>
                  
                    <div class="row"><a href="/docs/2.x/security/wire-encryption">Wire Encryption</a></div>
                  
                    <div class="row"><a href="/docs/2.x/security/kerberos">Kerberos</a></div>
                  
                </div>
              </div>
            </div>
          
        
          
        
      
        
          
        
          
            <div class="accordion-item">
              <div class="accordion-header fs-5 fw-bold" id="headingconfiguration">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseconfiguration" aria-expanded="false" aria-controls="collapseconfiguration">
                  Configuration
                </button>
              </div>
              <div id="collapseconfiguration" class="accordion-collapse collapse" aria-labelledby="headingconfiguration" data-bs-parent="#myAccordion">
                <div class="accordion-body">
                  
                  
                    <div class="row"><a href="/docs/2.x/configuration/overview">Configuration Overview</a></div>
                  
                    <div class="row"><a href="/docs/2.x/configuration/files">Configuration Files</a></div>
                  
                    <div class="row"><a href="/docs/2.x/configuration/client-properties">Client Properties (2.x)</a></div>
                  
                    <div class="row"><a href="/docs/2.x/configuration/client-properties3">Client Properties (3.x)</a></div>
                  
                    <div class="row"><a href="/docs/2.x/configuration/server-properties">Server Properties (2.x)</a></div>
                  
                    <div class="row"><a href="/docs/2.x/configuration/server-properties3">Server Properties (3.x)</a></div>
                  
                </div>
              </div>
            </div>
          
        
          
        
          
        
          
        
          
        
          
        
      
        
          
            <div class="accordion-item">
              <div class="accordion-header fs-5 fw-bold" id="headingadministration">
                <button class="accordion-button " type="button" data-bs-toggle="collapse" data-bs-target="#collapseadministration" aria-expanded="true" aria-controls="collapseadministration">
                  Administration
                </button>
              </div>
              <div id="collapseadministration" class="accordion-collapse collapse show" aria-labelledby="headingadministration" data-bs-parent="#myAccordion">
                <div class="accordion-body">
                  
                  
                    <div class="row selected"><a href="/docs/2.x/administration/in-depth-install">In-depth Installation</a></div>
                  
                    <div class="row"><a href="/docs/2.x/administration/monitoring-metrics">Monitoring & Metrics</a></div>
                  
                    <div class="row"><a href="/docs/2.x/administration/fate">FATE</a></div>
                  
                    <div class="row"><a href="/docs/2.x/administration/multivolume">Multi-Volume Installations</a></div>
                  
                    <div class="row"><a href="/docs/2.x/administration/replication">Replication</a></div>
                  
                    <div class="row"><a href="/docs/2.x/administration/caching">Caching</a></div>
                  
                    <div class="row"><a href="/docs/2.x/administration/compaction">Compactions</a></div>
                  
                    <div class="row"><a href="/docs/2.x/administration/upgrading">Upgrading Accumulo</a></div>
                  
                    <div class="row"><a href="/docs/2.x/administration/scan-executors">Scan Executors</a></div>
                  
                    <div class="row"><a href="/docs/2.x/administration/erasure-coding">Erasure Coding</a></div>
                  
                </div>
              </div>
            </div>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
            <div class="accordion-item">
              <div class="accordion-header fs-5 fw-bold" id="headingtroubleshooting">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapsetroubleshooting" aria-expanded="false" aria-controls="collapsetroubleshooting">
                  Troubleshooting
                </button>
              </div>
              <div id="collapsetroubleshooting" class="accordion-collapse collapse" aria-labelledby="headingtroubleshooting" data-bs-parent="#myAccordion">
                <div class="accordion-body">
                  
                  
                    <div class="row"><a href="/docs/2.x/troubleshooting/basic">Basic Troubleshooting</a></div>
                  
                    <div class="row"><a href="/docs/2.x/troubleshooting/advanced">Advanced Troubleshooting</a></div>
                  
                    <div class="row"><a href="/docs/2.x/troubleshooting/tools">Troubleshooting Tools</a></div>
                  
                    <div class="row"><a href="/docs/2.x/troubleshooting/system-metadata-tables">System Metadata Tables</a></div>
                  
                    <div class="row"><a href="/docs/2.x/troubleshooting/performance">Performance</a></div>
                  
                    <div class="row"><a href="/docs/2.x/troubleshooting/tracing">Tracing</a></div>
                  
                    <div class="row"><a href="/docs/2.x/troubleshooting/zookeeper">ZooKeeper</a></div>
                  
                </div>
              </div>
            </div>
          
        
      
    </div>
  </div>
  <div class="col-md-9">
    
    <p>Accumulo 2.x Documentation &gt;&gt; Administration &gt;&gt; In-depth Installation</p>
    
    
    <div class="row mt-4">
      <div class="col-md-12 d-flex justify-content-between">
        <h1>In-depth Installation</h1>
        <a href="https://github.com/apache/accumulo-website/edit/main/_docs-2/administration/in-depth-install.md" role="button"><span class="fa-solid fa-pen-to-square"></span> <small>Edit this page</small></a>
      </div>
    </div>
    
    <p>This document provides detailed instructions for installing Accumulo. For basic
instructions, see the <a href="/docs/2.x/getting-started/quickstart">quick start</a>.</p>

<h2 id="hardware">Hardware</h2>

<p>Because we are running essentially two or three systems simultaneously layered
across the cluster: HDFS, Accumulo and MapReduce, it is typical for hardware to
consist of 4 to 8 cores, and 8 to 32 GB RAM. This is so each running process can have
at least one core and 2 - 4 GB each.</p>

<p>One core running HDFS can typically keep 2 to 4 disks busy, so each machine may
typically have as little as 2 x 300GB disks and as much as 4 x 1TB or 2TB disks.</p>

<p>It is possible to do with less than this, such as with 1u servers with 2 cores and 4GB
each, but in this case it is recommended to only run up to two processes per
machine – i.e. DataNode and TabletServer or DataNode and MapReduce worker but
not all three. The constraint here is having enough available heap space for all the
processes on a machine.</p>

<h2 id="network">Network</h2>

<p>Accumulo communicates via remote procedure calls over TCP/IP for both passing
data and control messages. In addition, Accumulo uses HDFS clients to
communicate with HDFS. To achieve good ingest and query performance, sufficient
network bandwidth must be available between any two machines.</p>

<p>In addition to needing access to ports associated with HDFS and ZooKeeper, Accumulo will
use the following default ports. Please make sure that they are open, or change
their value in <a href="/docs/2.x/configuration/files#accumuloproperties">accumulo.properties</a>.</p>

<table>
  <thead>
    <tr>
      <th>Port</th>
      <th>Description</th>
      <th>Property Name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>4445</td>
      <td>Shutdown Port (Accumulo MiniCluster)</td>
      <td>n/a</td>
    </tr>
    <tr>
      <td>9132</td>
      <td>Accumulo Compaction Coordinator</td>
      <td><a href="/docs/2.x/configuration/server-properties#compaction_coordinator_port_client">compaction.coordinator.port.client</a></td>
    </tr>
    <tr>
      <td>9133</td>
      <td>Accumulo Compactor</td>
      <td><a href="/docs/2.x/configuration/server-properties#compactor_port_client">compactor.port.client</a></td>
    </tr>
    <tr>
      <td>9995</td>
      <td>Accumulo HTTP monitor</td>
      <td><a href="/docs/2.x/configuration/server-properties#monitor_port_client">monitor.port.client</a></td>
    </tr>
    <tr>
      <td>9996</td>
      <td>Accumulo Scan Server</td>
      <td><a href="/docs/2.x/configuration/server-properties#sserver_port_client">sserver.port.client</a></td>
    </tr>
    <tr>
      <td>9997</td>
      <td>Accumulo Tablet Server</td>
      <td><a href="/docs/2.x/configuration/server-properties#tserver_port_client">tserver.port.client</a></td>
    </tr>
    <tr>
      <td>9998</td>
      <td>Accumulo GC</td>
      <td><a href="/docs/2.x/configuration/server-properties#gc_port_client">gc.port.client</a></td>
    </tr>
    <tr>
      <td>9999</td>
      <td>Accumulo Manager Server</td>
      <td><a href="/docs/2.x/configuration/server-properties#manager_port_client">manager.port.client</a></td>
    </tr>
    <tr>
      <td>12234</td>
      <td>Accumulo Tracer</td>
      <td><a href="/docs/2.x/configuration/server-properties#trace_port_client">trace.port.client</a></td>
    </tr>
    <tr>
      <td>42424</td>
      <td>Accumulo Proxy Server</td>
      <td>n/a</td>
    </tr>
    <tr>
      <td>10001</td>
      <td>Accumulo Manager Replication service</td>
      <td><a href="/docs/2.x/configuration/server-properties#manager_replication_coordinator_port">manager.replication.coordinator.port</a></td>
    </tr>
    <tr>
      <td>10002</td>
      <td>Accumulo TabletServer Replication service</td>
      <td><a href="/docs/2.x/configuration/server-properties#replication_receipt_service_port">replication.receipt.service.port</a></td>
    </tr>
  </tbody>
</table>

<p>In addition, the user can provide <code class="language-plaintext highlighter-rouge">0</code> and an ephemeral port will be chosen instead. This
ephemeral port is likely to be unique and not already bound. Thus, configuring ports to
use <code class="language-plaintext highlighter-rouge">0</code> instead of an explicit value, should, in most cases, work around any issues of
running multiple distinct Accumulo instances (or any other process which tries to use the
same default ports) on the same hardware. Finally, the <code class="language-plaintext highlighter-rouge">*.port.client</code> properties will work
with the port range syntax (M-N) allowing the user to specify a range of ports for the
service to attempt to bind. The ports in the range will be tried in a 1-up manner starting
at the low end of the range to, and including, the high end of the range.</p>

<h2 id="download-tarball">Download Tarball</h2>

<p>Download a binary distribution of Accumulo and install it to a directory on a disk with
sufficient space:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> &lt;<span class="nb">install </span>directory&gt;
<span class="nb">tar </span>xzf accumulo-2.1.2-bin.tar.gz
<span class="nb">cd </span>accumulo-2.1.2
</code></pre></div></div>

<p>Repeat this step on each machine in your cluster. Typically, the same <code class="language-plaintext highlighter-rouge">&lt;install directory&gt;</code>
is chosen for all machines in the cluster.</p>

<p>There are four scripts in the <code class="language-plaintext highlighter-rouge">bin/</code> directory that are used to manage Accumulo:</p>

<ol>
  <li><code class="language-plaintext highlighter-rouge">accumulo</code> - Runs Accumulo command-line tools and starts Accumulo processes</li>
  <li><code class="language-plaintext highlighter-rouge">accumulo-service</code> - Runs Accumulo processes as services</li>
  <li><code class="language-plaintext highlighter-rouge">accumulo-cluster</code> - Manages Accumulo cluster on a single node or several nodes</li>
  <li><code class="language-plaintext highlighter-rouge">accumulo-util</code> - Accumulo utilities for creating configuration, native libraries, etc.</li>
</ol>

<p>These scripts will be used in the remaining instructions to configure and run Accumulo.</p>

<h2 id="dependencies">Dependencies</h2>

<p>Accumulo requires HDFS and ZooKeeper to be configured and running
before starting. Password-less SSH should be configured between at least the
Accumulo manager and TabletServer machines. It is also a good idea to run Network
Time Protocol (NTP) within the cluster to ensure nodes’ clocks don’t get too out of
sync, which can cause problems with automatically timestamped data.</p>

<h2 id="configuration">Configuration</h2>

<p>The Accumulo tarball contains a <code class="language-plaintext highlighter-rouge">conf/</code> directory where Accumulo looks for configuration. If you
installed Accumulo using downstream packaging, the <code class="language-plaintext highlighter-rouge">conf/</code> could be something else like
<code class="language-plaintext highlighter-rouge">/etc/accumulo/</code>.</p>

<p>Before starting Accumulo, the configuration files <a href="/docs/2.x/configuration/files#accumulo-envsh">accumulo-env.sh</a> and <a href="/docs/2.x/configuration/files#accumuloproperties">accumulo.properties</a> must
exist in <code class="language-plaintext highlighter-rouge">conf/</code> and be properly configured. If you are using <code class="language-plaintext highlighter-rouge">accumulo-cluster</code> to launch a
cluster, the <code class="language-plaintext highlighter-rouge">conf/</code> directory must also contain a <code class="language-plaintext highlighter-rouge">cluster.yaml</code> file. You can either create these files
manually or run <code class="language-plaintext highlighter-rouge">accumulo-cluster create-config</code>.</p>

<p>Logging is configured in <a href="/docs/2.x/configuration/files#accumulo-envsh">accumulo-env.sh</a> to use three log4j configuration files in <code class="language-plaintext highlighter-rouge">conf/</code>. The
file used depends on the Accumulo command or service being run. Logging for most Accumulo services
(i.e. Manager, TabletServer, Garbage Collector) is configured by <a href="/docs/2.x/configuration/files#log4j2-serviceproperties">log4j2-service.properties</a>. All Accumulo commands (i.e <code class="language-plaintext highlighter-rouge">init</code>,
<code class="language-plaintext highlighter-rouge">shell</code>, etc) are configured by <a href="/docs/2.x/configuration/files#log4j2properties">log4j2.properties</a>.</p>

<h3 id="configure-accumulo-envsh">Configure accumulo-env.sh</h3>

<p>Accumulo needs to know where to find the software it depends on. Edit <a href="/docs/2.x/configuration/files#accumulo-envsh">accumulo-env.sh</a>
and specify the following:</p>

<ol>
  <li>Enter the location of Hadoop for <code class="language-plaintext highlighter-rouge">$HADOOP_HOME</code></li>
  <li>Enter the location of ZooKeeper for <code class="language-plaintext highlighter-rouge">$ZOOKEEPER_HOME</code></li>
  <li>Optionally, choose a different location for Accumulo logs using <code class="language-plaintext highlighter-rouge">$ACCUMULO_LOG_DIR</code></li>
</ol>

<p>Accumulo uses <code class="language-plaintext highlighter-rouge">HADOOP_HOME</code> and <code class="language-plaintext highlighter-rouge">ZOOKEEPER_HOME</code> to locate Hadoop and Zookeeper jars
and add them to the <code class="language-plaintext highlighter-rouge">CLASSPATH</code> variable. If you are running a vendor-specific release of Hadoop
or Zookeeper, you may need to change how your <code class="language-plaintext highlighter-rouge">CLASSPATH</code> is built in <a href="/docs/2.x/configuration/files#accumulo-envsh">accumulo-env.sh</a>. If
Accumulo has problems later on finding jars, run <code class="language-plaintext highlighter-rouge">accumulo classpath</code> to print Accumulo’s
classpath.</p>

<p>You may want to change the default memory settings for Accumulo’s TabletServer which are
by set in the <code class="language-plaintext highlighter-rouge">JAVA_OPTS</code> settings for ‘tservers’ in <a href="/docs/2.x/configuration/files#accumulo-envsh">accumulo-env.sh</a>. Note the
syntax is that of the Java JVM command line options. This value should be less than the
physical memory of the machines running TabletServers.</p>

<p>There are similar options for the manager’s memory usage and the garbage collector
process. Reduce these if they exceed the physical RAM of your hardware and
increase them, within the bounds of the physical RAM, if a process fails because of
insufficient memory.</p>

<p>Note that you will be specifying the Java heap space in <a href="/docs/2.x/configuration/files#accumulo-envsh">accumulo-env.sh</a>. You should
make sure that the total heap space used for the Accumulo tserver and the Hadoop
DataNode and TaskTracker is less than the available memory on each worker node in
the cluster. On large clusters, it is recommended that the Accumulo manager, Hadoop
NameNode, secondary NameNode, and Hadoop JobTracker all be run on separate
machines to allow them to use more heap space. If you are running these on the
same machine on a small cluster, likewise make sure their heap space settings fit
within the available memory.</p>

<h3 id="native-map">Native Map</h3>

<p>The tablet server uses a data structure called a MemTable to store sorted key/value
pairs in memory when they are first received from the client. When a minor compaction
occurs, this data structure is written to HDFS. The MemTable will default to using
memory in the JVM but a JNI version, called the native map, can be used to significantly
speed up performance by utilizing the memory space of the native operating system. The
native map also avoids the performance implications brought on by garbage collection
in the JVM by causing it to pause much less frequently.</p>

<h4 id="building">Building</h4>

<p>32-bit and 64-bit Linux and Mac OS X versions of the native map can be built by executing
<code class="language-plaintext highlighter-rouge">accumulo-util build-native</code>. If your system’s default compiler options are insufficient,
you can add additional compiler options to the command line, such as options for the
architecture. These will be passed to the Makefile in the environment variable <code class="language-plaintext highlighter-rouge">USERFLAGS</code>.</p>

<p>Examples:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>accumulo-util build-native
accumulo-util build-native <span class="nt">-m32</span>
</code></pre></div></div>

<p>After building the native map from the source, you will find the artifact in
<code class="language-plaintext highlighter-rouge">lib/native</code>. Upon starting up, the tablet server will look
in this directory for the map library. If the file is renamed or moved from its
target directory, the tablet server may not be able to find it. The system can
also locate the native maps shared library by setting <code class="language-plaintext highlighter-rouge">LD_LIBRARY_PATH</code>
(or <code class="language-plaintext highlighter-rouge">DYLD_LIBRARY_PATH</code> on Mac OS X) in <a href="/docs/2.x/configuration/files#accumulo-envsh">accumulo-env.sh</a>.</p>

<h4 id="native-maps-configuration">Native Maps Configuration</h4>

<p>As mentioned, Accumulo will use the native libraries if they are found in the expected
location and <a href="/docs/2.x/configuration/server-properties#tserver_memory_maps_native_enabled">tserver.memory.maps.native.enabled</a> is set to <code class="language-plaintext highlighter-rouge">true</code> (which is the default).
Using the native maps over JVM Maps nets a noticeable improvement in ingest rates; however,
certain configuration variables are important to modify when increasing the size of the
native map.</p>

<p>To adjust the size of the native map, modify the value of <a href="/docs/2.x/configuration/server-properties#tserver_memory_maps_max">tserver.memory.maps.max</a>. When increasing
this value, it is also important to adjust the values below:</p>

<ul>
  <li><a href="/docs/2.x/configuration/server-properties#table_compaction_minor_logs_threshold">table.compaction.minor.logs.threshold</a> - maximum number of write-ahead log files that a tablet
can reference before they will be automatically minor compacted</li>
  <li><a href="/docs/2.x/configuration/server-properties#tserver_walog_max_size">tserver.walog.max.size</a> - maximum size of a write-ahead log.</li>
</ul>

<p>The maximum size of the native maps for a server should be less than the product of the write-ahead
log maximum size and minor compaction threshold for log files:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$table.compaction.minor.logs.threshold * $tserver.walog.max.size &gt;= $tserver.memory.maps.max
</code></pre></div></div>

<p>This formula ensures that minor compactions won’t be automatically triggered before the native
maps can be completely saturated.</p>

<p>Subsequently, when increasing the size of the write-ahead logs, it can also be important
to increase the HDFS block size that Accumulo uses when creating the files for the write-ahead log.
This is controlled via <a href="/docs/2.x/configuration/server-properties#tserver_wal_blocksize">tserver.wal.blocksize</a>. A basic recommendation is that when
<a href="/docs/2.x/configuration/server-properties#tserver_walog_max_size">tserver.walog.max.size</a> is larger than 2GB in size, set <a href="/docs/2.x/configuration/server-properties#tserver_wal_blocksize">tserver.wal.blocksize</a> to 2GB.
Increasing the block size to a value larger than 2GB can result in decreased write
performance to the write-ahead log file which will slow ingest.</p>

<h3 id="cluster-specification">Cluster Specification</h3>

<p>If you are using <code class="language-plaintext highlighter-rouge">accumulo-cluster</code> to start a cluster, configure the following on the
machine that will serve as the Accumulo manager:</p>

<ol>
  <li>Run <code class="language-plaintext highlighter-rouge">accumulo-cluster create-config</code> to create the <code class="language-plaintext highlighter-rouge">cluster.yaml</code> file.</li>
  <li>Write the IP address or domain name of the Accumulo Manager to the <a href="/docs/2.x/configuration/files#manager">manager</a> section.</li>
  <li>Write the IP addresses or domain name of the machines that will be TabletServers to the
<a href="/docs/2.x/configuration/files#tserver">tserver</a> section.</li>
</ol>

<p>Note that if using domain names rather than IP addresses, DNS must be configured
properly for all machines participating in the cluster. DNS can be a confusing source
of errors.</p>

<h3 id="configure-accumuloproperties">Configure accumulo.properties</h3>

<p>Specify appropriate values for the following properties in <a href="/docs/2.x/configuration/files#accumuloproperties">accumulo.properties</a>:</p>

<ul>
  <li><a href="/docs/2.x/configuration/server-properties#instance_zookeeper_host">instance.zookeeper.host</a> - Enables Accumulo to find ZooKeeper. Accumulo uses ZooKeeper
to coordinate settings between processes and helps finalize TabletServer failure.</li>
  <li><a href="/docs/2.x/configuration/server-properties#instance_secret">instance.secret</a> - The instance needs a secret to enable secure communication between servers.
Configure your secret and make sure that the <a href="/docs/2.x/configuration/files#accumuloproperties">accumulo.properties</a> file is not readable to other
users. For alternatives to storing the <a href="/docs/2.x/configuration/server-properties#instance_secret">instance.secret</a> in plaintext, please read the
<a href="#sensitive-configuration-values">Sensitive Configuration Values</a> section.</li>
</ul>

<p>Some settings can be modified via the Accumulo shell and take effect immediately, but some settings
require a process restart to take effect. See the <a href="/docs/2.x/configuration/overview">configuration overview</a>
documentation for details.</p>

<h3 id="hostnames-in-configuration-files">Hostnames in configuration files</h3>

<p>Accumulo has a number of configuration files which can contain references to other hosts in your
network. While IP addresses, short hostnames, or fully qualified domain names (FQDN) are all technically valid,
it is good practice to always use FQDNs for both Accumulo and other processes in your Hadoop
cluster. Failing to consistently use FQDNs can have unexpected consequences in how Accumulo uses
the FileSystem.</p>

<p>A common way for this problem can be observed is via applications that use Bulk Ingest. The Accumulo
Manager coordinates moving the input files to Bulk Ingest to an Accumulo-managed directory. However,
Accumulo cannot safely move files across different Hadoop FileSystems. This is problematic because
Accumulo also cannot make reliable assertions across what is the same FileSystem which is specified
with different names. Naively, while 127.0.0.1:8020 might be a valid identifier for an HDFS
instance, Accumulo identifies <code class="language-plaintext highlighter-rouge">localhost:8020</code> as a different HDFS instance than <code class="language-plaintext highlighter-rouge">127.0.0.1:8020</code>.</p>

<h3 id="deploy-configuration">Deploy Configuration</h3>

<p>Copy <a href="/docs/2.x/configuration/files#accumulo-envsh">accumulo-env.sh</a> and <a href="/docs/2.x/configuration/files#accumuloproperties">accumulo.properties</a> from the <code class="language-plaintext highlighter-rouge">conf/</code> directory on the manager to all
Accumulo tablet servers. The “host” configuration files <code class="language-plaintext highlighter-rouge">accumulo-cluster</code> only need to be on
servers where that command is run.</p>

<h3 id="sensitive-configuration-values">Sensitive Configuration Values</h3>

<p>Accumulo has a number of properties that can be specified via the <a href="/docs/2.x/configuration/files#accumuloproperties">accumulo.properties</a>
file which are sensitive in nature, <a href="/docs/2.x/configuration/server-properties#instance_secret">instance.secret</a> and <code class="language-plaintext highlighter-rouge">trace.token.property.password</code>
are two common examples. Both of these properties, if compromised, have the ability
to result in data being leaked to users who should not have access to that data.</p>

<p>In Hadoop-2.6.0, a new CredentialProvider class was introduced which serves as a common
implementation to abstract away the storage and retrieval of passwords from plaintext
storage in configuration files. Any Property marked with the <code class="language-plaintext highlighter-rouge">Sensitive</code> annotation
is a candidate for use with these CredentialProviders. For versions of Hadoop which lack
these classes, the feature will just be unavailable for use.</p>

<p>A comma separated list of CredentialProviders can be configured using the Accumulo Property
<a href="/docs/2.x/configuration/server-properties#general_security_credential_provider_paths">general.security.credential.provider.paths</a>. Each configured URL will be consulted
when the Configuration object for <a href="/docs/2.x/configuration/files#accumuloproperties">accumulo.properties</a> is accessed.</p>

<h3 id="using-a-javakeystorecredentialprovider-for-storage">Using a JavaKeyStoreCredentialProvider for storage</h3>

<p>One of the implementations provided in Hadoop-2.6.0 is a Java KeyStore CredentialProvider.
Each entry in the KeyStore is the Accumulo Property key name. For example, to store the
<a href="/docs/2.x/configuration/server-properties#instance_secret">instance.secret</a>, the following command can be used:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  hadoop credential create instance.secret --provider jceks://file/etc/accumulo/conf/accumulo.jceks
</code></pre></div></div>

<p>The command will then prompt you to enter the secret to use and create a keystore in:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  /path/to/accumulo/conf/accumulo.jceks
</code></pre></div></div>

<p>Then, <a href="/docs/2.x/configuration/files#accumuloproperties">accumulo.properties</a> must be configured to use this KeyStore as a CredentialProvider:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>general.security.credential.provider.paths=jceks://file/path/to/accumulo/conf/accumulo.jceks
</code></pre></div></div>

<p>This configuration will then transparently extract the <a href="/docs/2.x/configuration/server-properties#instance_secret">instance.secret</a> from
the configured KeyStore and eliminates human readable storage of the sensitive
property.</p>

<p>A KeyStore can also be stored in HDFS, which will make the KeyStore readily available to
all Accumulo servers. If the local filesystem is used, be aware that each Accumulo server
will expect the KeyStore in the same location.</p>

<h3 id="client-configuration">Client Configuration</h3>

<p>Accumulo clients are configured in a different way than Accumulo servers. <a href="/docs/2.x/getting-started/clients#creating-an-accumulo-client">Accumulo clients
are created</a> using Java builder methods or a <a href="/docs/2.x/configuration/files#accumulo-clientproperties">accumulo-client.properties</a>
file containing <a href="/docs/2.x/configuration/client-properties">client properties</a>.</p>

<h3 id="custom-table-tags">Custom Table Tags</h3>

<p>Accumulo has the ability for users to add custom tags to tables. This allows
applications to set application-level metadata about a table. These tags can be
anything from a table description, administrator notes, date created, etc.
This is done by naming and setting a property with a prefix <a href="/docs/2.x/configuration/server-properties#table_custom_prefix">table.custom.*</a>.</p>

<p>Currently, table properties are stored in ZooKeeper. This means that the number
and size of custom properties should be restricted on the order of 10’s of properties
at most without any properties exceeding 1MB in size. ZooKeeper’s performance can be
very sensitive to an excessive number of nodes and the sizes of the nodes. Applications
which leverage the user of custom properties should take these warnings into
consideration. There is no enforcement of these warnings via the API.</p>

<h3 id="configuring-the-classloader">Configuring the ClassLoader</h3>

<p>Accumulo builds its Java classpath in <a href="/docs/2.x/configuration/files#accumulo-envsh">accumulo-env.sh</a>. This classpath can be viewed by running
<code class="language-plaintext highlighter-rouge">accumulo classpath</code>.</p>

<p>After an Accumulo application has started, it will load classes from the locations specified in the
deprecated <a href="/docs/2.x/configuration/server-properties#general_classpaths">general.classpaths</a> property. Additionally, Accumulo will load classes from the
locations specified in the <a href="/docs/2.x/configuration/server-properties#general_dynamic_classpaths">general.dynamic.classpaths</a> property and will monitor and reload them if
they change. The reloading feature is useful during the development and testing of iterators as new
or modified iterator classes can be deployed to Accumulo without having to restart the database.</p>

<p>Accumulo also has an alternate configuration for the classloader which will allow it to load classes
from remote locations. This mechanism uses Apache Commons VFS which enables locations such as http
and hdfs to be used. This alternate configuration also uses the <a href="/docs/2.x/configuration/server-properties#general_classpaths">general.classpaths</a> property in the
same manner described above. It differs in that you need to configure the <a href="/docs/2.x/configuration/server-properties#general_vfs_classpaths">general.vfs.classpaths</a>
property instead of the <a href="/docs/2.x/configuration/server-properties#general_dynamic_classpaths">general.dynamic.classpaths</a> property. As in the default configuration, this
alternate configuration will also monitor the vfs locations for changes and reload if necessary.</p>

<h5 id="classloader-contexts">ClassLoader Contexts</h5>

<p>With the addition of the VFS based classloader, we introduced the notion of classloader contexts. A
context is identified by a name and references a set of locations from which to load classes and can
be specified in the <a href="/docs/2.x/configuration/files#accumuloproperties">accumulo.properties</a> file or added using the <code class="language-plaintext highlighter-rouge">config</code> command in the shell.
Below is an example for specify the app1 context in the <a href="/docs/2.x/configuration/files#accumuloproperties">accumulo.properties</a> file:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Application A classpath, loads jars from HDFS and local file system
general.vfs.context.classpath.app1=hdfs://localhost:8020/applicationA/classpath/.*.jar,file:///opt/applicationA/lib/.*.jar
</code></pre></div></div>

<p>The default behavior follows the Java ClassLoader contract in that classes, if they exist, are
loaded from the parent classloader first. You can override this behavior by delegating to the parent
classloader after looking in this classloader first. An example of this configuration is:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>general.vfs.context.classpath.app1.delegation=post
</code></pre></div></div>

<p>To use contexts in your application you can set the <a href="/docs/2.x/configuration/server-properties#table_classpath_context">table.classpath.context</a> on your
tables or use the <code class="language-plaintext highlighter-rouge">setClassLoaderContext()</code> method on Scanner and BatchScanner passing in the name
of the context, app1 in the example above. Setting the property on the table allows your minc, majc,
and scan iterators to load classes from the locations defined by the context. Passing the context
name to the scanners allows you to override the table setting to load only scan time iterators from
a different location.</p>

<h2 id="initialization">Initialization</h2>

<p>Accumulo must be initialized to create the structures it uses internally to locate
data across the cluster. HDFS is required to be configured and running before
Accumulo can be initialized.</p>

<p>Once HDFS is started, initialization can be performed by executing <code class="language-plaintext highlighter-rouge">accumulo init</code>. This script will
prompt for a name for this instance of Accumulo. The instance name is used to identify a set of
tables and instance-specific settings. The script will then write some information into HDFS so
Accumulo can start properly.</p>

<p>The initialization script will prompt you to set a root password. Once Accumulo is initialized it
can be started.</p>

<h2 id="running">Running</h2>

<h3 id="starting-accumulo">Starting Accumulo</h3>

<p>Make sure Hadoop is configured on all of the machines in the cluster, including access to a shared
HDFS instance. Make sure HDFS and ZooKeeper are running. Make sure ZooKeeper is configured and
running on at least one machine in the cluster. Start Accumulo using <code class="language-plaintext highlighter-rouge">accumulo-cluster start</code>.</p>

<p>To verify that Accumulo is running, check the <a href="/docs/2.x/administration/monitoring-metrics#monitor">Accumulo monitor</a>. In addition, the Shell
can provide some information about the status of tables via reading the metadata tables.</p>

<h3 id="stopping-accumulo">Stopping Accumulo</h3>

<p>To shutdown cleanly, run <code class="language-plaintext highlighter-rouge">accumulo-cluster stop</code> and the manager will orchestrate the
shutdown of all the tablet servers. Shutdown waits for all minor compactions to finish, so it may
take some time for particular configurations.</p>

<h3 id="adding-a-tablet-server">Adding a Tablet Server</h3>

<p>Update your <code class="language-plaintext highlighter-rouge">conf/cluster.yaml</code> file to account for the addition.</p>

<p>Next, ssh to each of the hosts you want to add and run:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>accumulo-service tserver start
</code></pre></div></div>

<p>Make sure the host in question has the new configuration, or else the tablet
server won’t start; at a minimum this needs to be on the host(s) being added,
but in practice it’s good to ensure consistent configuration across all nodes.</p>

<h3 id="decommissioning-a-tablet-server">Decommissioning a Tablet Server</h3>

<p>If you need to take a node out of operation, you can trigger a graceful shutdown of a tablet
server. Accumulo will automatically rebalance the tablets across the available tablet servers.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>accumulo admin stop &lt;host<span class="o">(</span>s<span class="o">)&gt;</span> <span class="o">{</span>&lt;host&gt; ...<span class="o">}</span>
</code></pre></div></div>

<p>Alternatively, you can ssh to each of the hosts you want to remove and run:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>accumulo-service tserver stop
</code></pre></div></div>

<p>Be sure to update your <code class="language-plaintext highlighter-rouge">conf/cluster.yaml</code> file to account for the removal of these hosts. Bear in mind
that the monitor will not re-read the tservers file automatically, so it will report the
decommissioned servers as down; it’s recommended that you restart the monitor so that the node list
is up to date.</p>

<p>The steps described to decommission a node can also be used (without removal of the host from the
<code class="language-plaintext highlighter-rouge">conf/cluster.yaml</code> file) to gracefully stop a node. This will ensure that the tabletserver is cleanly
stopped and recovery will not need to be performed when the tablets are re-hosted.</p>

<h3 id="restarting-process-on-a-node">Restarting process on a node</h3>

<p>Occasionally, it might be necessary to restart the processes on a specific node. In addition
to the <code class="language-plaintext highlighter-rouge">accumulo-cluster</code> script, Accumulo has a <code class="language-plaintext highlighter-rouge">accumulo-service</code> script that
can be used to start/stop processes on a node.</p>

<h4 id="a-note-on-rolling-restarts">A note on rolling restarts</h4>

<p>For sufficiently large Accumulo clusters, restarting multiple TabletServers within a short window
can place significant load on the Manager server. If slightly lower availability is acceptable, this
load can be reduced by globally setting <a href="/docs/2.x/configuration/server-properties#table_suspend_duration">table.suspend.duration</a> to a positive value.</p>

<p>With <a href="/docs/2.x/configuration/server-properties#table_suspend_duration">table.suspend.duration</a> set to, say, <code class="language-plaintext highlighter-rouge">5m</code>, Accumulo will wait for 5 minutes for any dead
TabletServer to return before reassigning that TabletServer’s responsibilities to other
TabletServers. If the TabletServer returns to the cluster before the specified timeout has elapsed,
Accumulo will assign the TabletServer its original responsibilities.</p>

<p>Tablet Status: Normally tablets will be in a HOSTED state. When a tserver goes off-line, the tablets
assigned will transition to UNASSIGNED until they are reassigned by the Manager process to another
active tserver.  With the <a href="/docs/2.x/configuration/server-properties#table_suspend_duration">table.suspend.duration</a> set to &gt; 0, a tablet will go from HOSTED to
SUSPENDED when the tserver goes offline. The tablets will stay SUSPENDED until the tserver comes
back online or, if the <a href="/docs/2.x/configuration/server-properties#table_suspend_duration">table.suspend.duration</a> has passed. If the table.suspend.duration has passed
before the tserver has returned, it will then become UNASSIGNED and eligible for reassignment
by the Manager. If a tablet is UNASSIGNED it will not enter the SUSPENDED state.</p>

<p>It is important not to choose too large a value for <a href="/docs/2.x/configuration/server-properties#table_suspend_duration">table.suspend.duration</a>, as during this time,
all scans against the data that TabletServer had hosted will block (or time out).</p>

<h3 id="running-multiple-tabletservers-on-a-single-node">Running multiple TabletServers on a single node</h3>

<p>With very powerful nodes, it may be beneficial to run more than one TabletServer on a given
node. This decision should be made carefully and with much deliberation as Accumulo is designed
to be able to scale to using 10’s of GB of RAM and 10’s of CPU cores.</p>

<p>Accumulo TabletServers bind certain ports on the host to accommodate remote procedure calls to/from
other nodes. Running more than one TabletServer on a host requires that you set the environment
variable <code class="language-plaintext highlighter-rouge">ACCUMULO_SERVICE_INSTANCE</code> to an instance number (i.e 1, 2) for each instance that is
started. Also, set the these properties in <a href="/docs/2.x/configuration/files#accumuloproperties">accumulo.properties</a>:</p>

<ul>
  <li><a href="/docs/2.x/configuration/server-properties#tserver_port_search">tserver.port.search</a> = <code class="language-plaintext highlighter-rouge">true</code></li>
  <li><a href="/docs/2.x/configuration/server-properties#replication_receipt_service_port">replication.receipt.service.port</a> = <code class="language-plaintext highlighter-rouge">0</code></li>
</ul>

<p>In order to start multiple TabletServers on a node, the <code class="language-plaintext highlighter-rouge">accumulo</code> command must be used:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ACCUMULO_SERVICE_INSTANCE=1 ./bin/accumulo tserver &amp;&gt; ./logs/tserver1.out &amp;
ACCUMULO_SERVICE_INSTANCE=2 ./bin/accumulo tserver &amp;&gt; ./logs/tserver2.out &amp;
</code></pre></div></div>

<h4 id="running-multiple-tabletservers-per-node-in-accumulo-210-and-later">Running multiple TabletServers per node in Accumulo 2.1.0 and later</h4>
<p>Starting with Accumulo 2.1.0, the <code class="language-plaintext highlighter-rouge">accumulo-cluster</code> script can be used along with environment
variable <code class="language-plaintext highlighter-rouge">NUM_TSERVERS</code> as a convenient alternative to the <code class="language-plaintext highlighter-rouge">accumulo</code> command to start / stop
multiple TabletServers per node. For example, the following commands can be used to start / stop
2 TabletServers on the current node:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>NUM_TSERVERS=2 ./bin/accumulo-cluster start-here
NUM_TSERVERS=2 ./bin/accumulo-cluster stop-here
</code></pre></div></div>

<p>To start / stop the entire Accumulo cluster with 2 TabletServers per worker node, use:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>NUM_TSERVERS=2 ./bin/accumulo-cluster start
NUM_TSERVERS=2 ./bin/accumulo-cluster stop
</code></pre></div></div>

<p>Other commands like <code class="language-plaintext highlighter-rouge">accumulo-cluster start-tservers</code> and <code class="language-plaintext highlighter-rouge">accumulo-cluster stop-tservers</code> support
the use of <code class="language-plaintext highlighter-rouge">NUM_TSERVERS</code> to specify the number of TabletServers per worker node.</p>

<p>When <code class="language-plaintext highlighter-rouge">accumulo-cluster</code> is used along with <code class="language-plaintext highlighter-rouge">NUM_TSERVERS</code> greater than 1, the resultant log files
and redirected stdout / stderr files for each TabletServer running on the node have the instance
number as part of their respective filenames.</p>

<p>Lastly, starting with Accumulo 2.1.0 the <code class="language-plaintext highlighter-rouge">accumulo-env.sh</code> script ensures that Accumulo metrics
are correctly associated with the respective instance number for each TabletServer on a node.</p>

<h2 id="logging">Logging</h2>

<p>Accumulo processes each write to a set of log files. By default, these logs are found at directory
set by <code class="language-plaintext highlighter-rouge">ACCUMULO_LOG_DIR</code> in <a href="/docs/2.x/configuration/files#accumulo-envsh">accumulo-env.sh</a>.</p>

<h3 id="audit-logging">Audit Logging</h3>

<p>Accumulo logs many user-initiated actions, and whether they succeeded or failed, to an slf4j logger
named <code class="language-plaintext highlighter-rouge">org.apache.accumulo.audit</code>. This logger can be configured in the user’s logging framework
(such as log4j or logback). In the tarball, the configuration file <code class="language-plaintext highlighter-rouge">conf/log4j2-service.properties</code>
demonstrates basic audit logging with example configuration options for log4j.</p>

<h2 id="recovery">Recovery</h2>

<p>In the event of TabletServer failure or error on shutting Accumulo down, some
mutations may not have been minor compacted to HDFS properly. In this case,
Accumulo will automatically reapply such mutations from the write-ahead log
either when the tablets from the failed server are reassigned by the Manager (in the
case of a single TabletServer failure) or the next time Accumulo starts (in the event of
failure during shutdown).</p>

<p>Recovery is performed by asking a tablet server to sort the logs so that tablets can easily find
their missing updates. The sort status of each file is displayed on Accumulo monitor status page.
Once the recovery is complete any tablets involved should return to an <code class="language-plaintext highlighter-rouge">online</code> state. Until then
those tablets will be unavailable to clients.</p>

<p>The Accumulo client library is configured to retry failed mutations and in many
cases clients will be able to continue processing after the recovery process without
throwing an exception.</p>

<h2 id="migrating-accumulo-from-non-ha-namenode-to-ha-namenode">Migrating Accumulo from non-HA Namenode to HA Namenode</h2>

<p>The following steps will allow a non-HA instance to be migrated to an HA instance. Consider an HDFS
URL <code class="language-plaintext highlighter-rouge">hdfs://namenode.example.com:8020</code> which is going to be moved to <code class="language-plaintext highlighter-rouge">hdfs://nameservice1</code>.</p>

<p>Before moving HDFS over to the HA namenode, use <code class="language-plaintext highlighter-rouge">accumulo admin volumes</code> to confirm
that the only volume displayed is the volume from the current namenode’s HDFS URL.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Listing volumes referenced in zookeeper
    Volume : hdfs://namenode.example.com:8020/accumulo

Listing volumes referenced in accumulo.root tablets section
    Volume : hdfs://namenode.example.com:8020/accumulo
Listing volumes referenced in accumulo.root deletes section (volume replacement occurs at deletion time)

Listing volumes referenced in accumulo.metadata tablets section
    Volume : hdfs://namenode.example.com:8020/accumulo

Listing volumes referenced in accumulo.metadata deletes section (volume replacement occurs at deletion time)
</code></pre></div></div>

<p>After verifying the current volume is correct, shut down the cluster and transition HDFS to the HA
nameservice.</p>

<p>Edit <a href="/docs/2.x/configuration/files#accumuloproperties">accumulo.properties</a> to notify accumulo that a volume is being replaced. First, add the new
nameservice volume to the <a href="/docs/2.x/configuration/server-properties#instance_volumes">instance.volumes</a> property. Next, add the <a href="/docs/2.x/configuration/server-properties#instance_volumes_replacements">instance.volumes.replacements</a>
property in the form of <code class="language-plaintext highlighter-rouge">old new</code>. It’s important to not include the volume that’s being replaced in
<a href="/docs/2.x/configuration/server-properties#instance_volumes">instance.volumes</a>, otherwise it’s possible accumulo could continue to write to the volume.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># instance.dfs.uri and instance.dfs.dir should not be set
instance.volumes=hdfs://nameservice1/accumulo
instance.volumes.replacements=hdfs://namenode.example.com:8020/accumulo hdfs://nameservice1/accumulo
</code></pre></div></div>

<p>Run <code class="language-plaintext highlighter-rouge">accumulo init --add-volumes</code> and start up the accumulo cluster. Verify that the
new nameservice volume shows up with <code class="language-plaintext highlighter-rouge">accumulo admin volumes</code>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Listing volumes referenced in zookeeper
    Volume : hdfs://namenode.example.com:8020/accumulo
    Volume : hdfs://nameservice1/accumulo

Listing volumes referenced in accumulo.root tablets section
    Volume : hdfs://namenode.example.com:8020/accumulo
    Volume : hdfs://nameservice1/accumulo
Listing volumes referenced in accumulo.root deletes section (volume replacement occurs at deletion time)

Listing volumes referenced in accumulo.metadata tablets section
    Volume : hdfs://namenode.example.com:8020/accumulo
    Volume : hdfs://nameservice1/accumulo
Listing volumes referenced in accumulo.metadata deletes section (volume replacement occurs at deletion time)
</code></pre></div></div>

<p>Some erroneous GarbageCollector messages may still be seen for a small period while data is
transitioning to the new volumes. This is expected and can usually be ignored.</p>

<h2 id="achieving-stability-in-a-vm-environment">Achieving Stability in a VM Environment</h2>

<p>For testing, demonstration, and even operation uses, Accumulo is often
installed and run in a virtual machine (VM) environment. The majority of
long-term operational uses of Accumulo are on bare-metal cluster. However, the
core design of Accumulo and its dependencies do not preclude running stably for
long periods within a VM. Many of Accumulo’s operational robustness features to
handle failures like periodic network partitioning in a large cluster carry
over well to VM environments. This guide covers general recommendations for
maximizing stability in a VM environment, including some of the common failure
modes that are more common when running in VMs.</p>

<h3 id="known-failure-modes-setup-and-troubleshooting">Known failure modes: Setup and Troubleshooting</h3>

<p>In addition to the general failure modes of running Accumulo, VMs can introduce a
couple of environmental challenges that can affect process stability. Clock
drift is something that is more common in VMs, especially when VMs are
suspended and resumed. Clock drift can cause Accumulo servers to assume that
they have lost connectivity to the other Accumulo processes and/or lose their
locks in Zookeeper. VM environments also frequently have constrained resources,
such as CPU, RAM, network, and disk throughput and capacity. Accumulo generally
deals well with constrained resources from a stability perspective (optimizing
performance will require additional tuning, which is not covered in this
section), however there are some limits.</p>

<h4 id="physical-memory">Physical Memory</h4>

<p>One of those limits has to do with the Linux out of memory killer. A common
failure mode in VM environments (and in some bare metal installations) is when
the Linux out of memory killer decides to kill processes in order to avoid a
kernel panic when provisioning a memory page. This often happens in VMs due to
the large number of processes that must run in a small memory footprint. In
addition to the Linux core processes, a single-node Accumulo setup requires a
Hadoop Namenode, a Hadoop Secondary Namenode a Hadoop Datanode, a Zookeeper
server, an Accumulo Manager, an Accumulo GC and an Accumulo TabletServer.
Typical setups also include an Accumulo Monitor, an Accumulo Tracer, a Hadoop
ResourceManager, a Hadoop NodeManager, provisioning software, and client
applications. Between all of these processes, it is not uncommon to
over-subscribe the available RAM in a VM. We recommend setting up VMs without
swap enabled, so rather than performance grinding to a halt when physical
memory is exhausted the kernel will randomly select processes to kill in order
to free up memory.</p>

<p>Calculating the maximum possible memory usage is essential in creating a stable
Accumulo VM setup. Safely engineering memory allocation for stability is a
matter of then bringing the calculated maximum memory usage under the physical
memory by a healthy margin. The margin is to account for operating system-level
operations, such as managing process, maintaining virtual memory pages, and
file system caching. When the java out-of-memory killer finds your process, you
will probably only see evidence of that in /var/log/messages. Out-of-memory
process kills do not show up in Accumulo or Hadoop logs.</p>

<p>To calculate the max memory usage of all java virtual machine (JVM) processes
add the maximum heap size (often limited by a -Xmx… argument, such as in
accumulo.properties) and the off-heap memory usage. Off-heap memory usage
includes the following:</p>

<ul>
  <li>“Permanent Space”, where the JVM stores Classes, Methods, and other code elements. This can be
limited by a JVM flag such as <code class="language-plaintext highlighter-rouge">-XX:MaxPermSize:100m</code>, and is typically tens of megabytes.</li>
  <li>Code generation space, where the JVM stores just-in-time compiled code. This is typically small
enough to ignore</li>
  <li>Socket buffers, where the JVM stores send and receive buffers for each socket.</li>
  <li>Thread stacks, where the JVM allocates memory to manage each thread.</li>
  <li>Direct memory space and JNI code, where applications can allocate memory outside of the
JVM-managed space. For Accumulo, this includes the native in-memory maps that are allocated with
the memory.maps.max parameter in accumulo.properties.</li>
  <li>Garbage collection space, where the JVM stores information used for garbage collection.</li>
</ul>

<p>You can assume that each Hadoop and Accumulo process will use ~100-150MB for
Off-heap memory, plus the in-memory map of the Accumulo TServer process. A
simple calculation for physical memory requirements follows:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Physical memory needed
  = (per-process off-heap memory) + (heap memory) + (other processes) + (margin)
  = (number of java processes * 150M + native map) + (sum of -Xmx settings for java process)
      + (total applications memory, provisioning memory, etc.) + (1G)
  = (11*150M +500M) + (1G +1G +1G +256M +1G +256M +512M +512M +512M +512M +512M) + (2G) + (1G)
  = (2150M) + (7G) + (2G) + (1G)
  = ~12GB
</code></pre></div></div>

<p>These calculations can add up quickly with the large number of processes,
especially in constrained VM environments. To reduce the physical memory
requirements, it is a good idea to reduce maximum heap limits and turn off
unnecessary processes. If you’re not using YARN in your application, you can
turn off the ResourceManager and NodeManager. If you’re not expecting to
re-provision the cluster frequently you can turn off or reduce provisioning
processes such as Salt Stack minions and managers.</p>

<h4 id="disk-space">Disk Space</h4>

<p>Disk space is primarily used for two operations: storing data and storing logs.
While Accumulo generally stores all of its key/value data in HDFS, Accumulo,
Hadoop, and Zookeeper all store a significant amount of logs in a directory on
a local file system. Care should be taken to make sure that (a) limitations to
the amount of logs generated are in place, and (b) enough space is available to
host the generated logs on the partitions that they are assigned. When space is
not available to log, processes will hang. This can cause interruptions in
availability of Accumulo, as well as cascade into failures of various
processes.</p>

<p>Hadoop, Accumulo, and Zookeeper use log4j as a logging mechanism, and each of
them has a way of limiting the logs and directing them to a particular
directory. Logs are generated independently for each process, so when
considering the total space you need to add up the maximum logs generated by
each process. Typically, a rolling log setup in which each process can generate
something like 10 100MB files is instituted, resulting in a maximum file system
usage of 1GB per process. Default setups for Hadoop and Zookeeper are often
unbounded, so it is important to set these limits in the logging configuration
files for each subsystem. Consult the user manual for each system for
instructions on how to limit generated logs.</p>

<h4 id="zookeeper-interaction">Zookeeper Interaction</h4>

<p>Accumulo is designed to scale up to thousands of nodes. At that scale,
intermittent interruptions in network service and other rare failures of
compute nodes become more common. To limit the impact of node failures on
overall service availability, Accumulo uses a heartbeat monitoring system that
leverages Zookeeper’s ephemeral locks. There are several conditions that can
occur that cause Accumulo process to lose their Zookeeper locks, some of which
are true interruptions to availability and some of which are false positives.
Several of these conditions become more common in VM environments, where they
can be exacerbated by resource constraints and clock drift.</p>

<h4 id="tested-versions">Tested Versions</h4>

<p>Each release of Accumulo is built with a specific version of Apache
Hadoop, Apache ZooKeeper and Apache Thrift. We expect Accumulo to
work with versions that are API compatible with those versions.
However, this compatibility is not guaranteed because Hadoop, ZooKeeper
and Thrift may not provide guarantees between their own versions. We
have also found that certain versions of Accumulo and Hadoop included
bugs that greatly affected overall stability. Thrift is particularly
prone to compatibility changes between versions, and you must use the
same version your Accumulo is built with.</p>

<p>Please check the release notes for your Accumulo version or use the
<a href="/contact-us">mailing lists</a> for more info.</p>


    <div class="row mt-4">
      <div class="col-md-12 d-flex justify-content-between">
        <strong>Find documentation for all releases in the <a href="/docs-archive">archive</strong>
        <a href="https://github.com/apache/accumulo-website/edit/main/_docs-2/administration/in-depth-install.md" role="button"><span class="fa-solid fa-pen-to-square"></span> <small>Edit this page</small></a>
      </div>
    </div>
  </div>
</div>

        </div>

        
<footer>

  <p><a href="https://www.apache.org/foundation/contributing"><img src="https://www.apache.org/images/SupportApache-small.png" alt="Support the ASF" id="asf-logo" height="100" /></a></p>

  <p>Copyright © 2011-2023 <a href="https://www.apache.org">The Apache Software Foundation</a>.
Licensed under the <a href="https://www.apache.org/licenses/">Apache License, Version 2.0</a>.</p>

  <p>Apache®, the names of Apache projects and their logos, and the multicolor feather
logo are registered trademarks or trademarks of The Apache Software Foundation
in the United States and/or other countries.</p>

</footer>


      </div>
    </div>
  </div>
</body>
</html>
